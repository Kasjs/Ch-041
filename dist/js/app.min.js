!function(){"use strict";angular.module("rssreader",["ui.router","ngAnimate","ngValidate","ngFileUpload","ngTouch","favicon","dndLists","satellizer","angular-jwt","720kb.socialshare","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$authProvider",function(e,t,r){t.otherwise("home"),e.state("home",{url:"/home",templateUrl:"./partials/home.html",controller:"HomeController"}).state("login",{url:"/login",templateUrl:"./partials/auth/login.html",controller:"AuthController",onEnter:["$state","authService",function(e,t){t.isLoggedIn()&&e.go("home")}]}).state("register",{url:"/register",templateUrl:"./partials/auth/register.html",controller:"AuthController",onEnter:["$state","authService",function(e,t){t.isLoggedIn()&&e.go("home")}]}).state("forgot",{url:"/forgot",templateUrl:"./partials/auth/forgot.html",controller:"AuthController"}).state("reset",{url:"/reset/:token",templateUrl:"./partials/auth/reset.html",controller:"AuthController",onEnter:["$stateParams","transfer",function(e,t){t.setObj(e.token)}]}).state("verify",{url:"/verify/:token/:email",templateUrl:"./partials/auth/verify.html",controller:"AuthController",onEnter:["$stateParams","transfer","toasterService",function(e,t,r){t.setEmail(e.email),t.setString(e.token),console.log(e),r.info("You have successfuly approved you email. Please reenter you fields")}]}).state("profile",{url:"/profile",templateUrl:"./partials/auth/profile.html",controller:"ProfileController",resolve:{profilePromise:["profileService",function(e){return e.getProfile()}]},onEnter:["$state","authService",function(e,t){t.isLoggedIn()||(t.logOut(),e.go("home"))}]}).state("dashboard",{url:"/dashboard",views:{"":{templateUrl:"./partials/dashboard/dashboard.html",controller:"DashboardController"},"sidebar@dashboard":{templateUrl:"./partials/dashboard/sidebar.html",controller:"SidebarController"},"feedHead@dashboard":{templateUrl:"./partials/dashboard/feed-head.html",controller:"DashboardController"}},resolve:{profilePromise:["profileService",function(e){return e.getProfile()}],feedPromise:["feedsService",function(e){return e.getAllFeeds()}]},onEnter:["articlesService","dashboardService",function(e,t){e.getAllArticles()}]}).state("dashboard.list",{url:"/list",templateUrl:"./partials/list/list.html",controller:"ArticlesController"}).state("dashboard.th-list",{url:"/th-list",templateUrl:"./partials/list/th-list.html",controller:"ArticlesController"}).state("dashboard.th-large",{url:"/th-large",templateUrl:"./partials/list/th-large.html",controller:"ArticlesController"}).state("dashboard.addFeed",{url:"/add",templateUrl:"./partials/dashboard/add-feed.html",controller:"FeedsController",onEnter:["dashboardService",function(e){e.setTitle("Add Feed")}]}),r.twitter({clientId:"768721225971560448",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:"http://localhost:8080",oauthType:"1.0",popupOptions:{width:495,height:645}}),r.linkedin({clientId:"78ffzenowt180q",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:"http://localhost:8080",requiredUrlParams:["state"],scopeDelimiter:" ",state:"STATE",oauthType:"2.0",popupOptions:{width:527,height:582}}),r.facebook({clientId:"173686319709284",name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:window.location.origin+"/",requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",oauthType:"2.0",popupOptions:{width:580,height:400}}),r.google({clientId:"806677097865-va2i3kq96mmu8i00t9k6q92ks1s9tg0l.apps.googleusercontent.com",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:"http://localhost:8080",requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:452,height:633}})}])}(),angular.module("rssreader").directive("modal",[function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(e,t,r){e.modalStyle={},e.hideModal=function(){e.show=!1}},templateUrl:"../partials/modals/modal.html"}}]),angular.module("rssreader").directive("pwCheck",[function(){return{require:"ngModel",link:function(e,t,r,a){var o="#"+r.pwCheck;t.add(o).on("keyup",function(){e.$apply(function(){if(""!==t.val()){var e=t.val()===$(o).val();a.$setValidity("pwmatch",e)}})})}}}]),angular.module("rssreader").directive("checkStrength",[function(){return{replace:!1,restrict:"EACM",link:function(e,t,r){var a={colors:["#F00","#F90","#FF0","#9F0","#0F0"],mesureStrength:function(t){if(t){var r=0,a=/[#@$-\/:-?-~!"^_`]/g,o=/[a-z]+/.test(t),n=/[A-Z]+/.test(t),i=/[0-9]+/.test(t),s=a.test(t),l=[o,n,i,s],c=$.grep(l,function(e){return e===!0}).length;return r+=2*t.length+(t.length>=10?1:0),r+=10*c,r=t.length<=5?Math.min(r,10):r,r=1==c?Math.min(r,10):r,r=2==c?Math.min(r,20):r,r=3==c?Math.min(r,40):r}return e.user.password=""},getColor:function(e){var t=0;return t=e<=10?0:e<=20?1:e<=30?2:e<=40?3:4,{idx:t+1,col:this.colors[t]}}};e.$watch(r.checkStrength,function(){if(""===e.user.password&&t.css({display:"none"}),""===e.password.pas)t.css({display:"none"});else{var r=a.getColor(a.mesureStrength(e.user.password||e.password.pas));t.css({display:"block"}),t.children("li").css({background:"#DDD"}).slice(0,r.idx).css({background:r.col})}})},template:'<li class="point"></li><li class="point"></li><li class="point"></li><li class="point"></li><li class="point"></li>'}}]),angular.module("rssreader").directive("toaster",["$timeout","toasterService",function(e,t){return{restrict:"E",transclude:!0,link:function(r,a,o){o.overlay?r.overlay=!0:r.overlay=!1,o.delay?r.delay=o.delay:r.delay=5e3,r.toasterStyle={},r.confirm=function(){r.$parent[o.confirm](),r.hideToaster()},r.reject=function(){r.hideToaster()},r.hideToaster=function(){e.cancel(r.timer),r.$destroy(),t.removeToaster(a)},r.timer=e(function(){r.hideToaster()},r.delay)},templateUrl:"../partials/modals/toaster.html"}}]),function(){"use strict";angular.module("rssreader").controller("ArticlesController",["$scope","$state","toasterService","dateFilter","feedsService","articlesService","dashboardService",function(e,t,r,a,o,n,i){e.obj={},e.newCatObj={},e.categories=o.allFavsCategories,e.error=null,e.modalShown=!1,e.articles=n.articles,e.isFavourites=n.checkIfFavourites,e.favForAdd={},e.favForRemove={},e.articleForShare={},e.sortParam=i.sortParam,e.addingNewFavCategory=!1,e.getSortParam=function(){return e.sortParam=i.sortParam,e.sortParam},e.checkIfNew=function(){e.obj.category.toUpperCase()=="custom".toUpperCase()?e.addingNewFavCategory=!0:(e.addingNewFavCategory=!1,e.newCatObj.category=null)},e.addFavourite=function(t){e.error=null,e.modalShown=!e.modalShown,e.favForAdd=t},e.confirmAddFavourite=function(){e.newCatObj.category&&(e.obj.category=e.newCatObj.category),e.favForAdd.category=e.obj.category,n.addFavourite(e.favForAdd).then(function(a){e.addingNewCategory=!1,r.success("Article marked as favourite"),t.reload("dashboard")},function(t){console.log(t),t.data?e.error=t.data.message:e.error=t.message})},e.cancelAddFavourite=function(){e.modalShown=!1,e.favForAdd={}},e.share=function(t){e.error=null,e.articleForShare=t},e.cancelSharing=function(){e.modalShareShown=!1,e.articleForShare={}},e.removeFavourite=function(t){e.favForRemove=t,r.confirm({message:"Remove this article?",confirm:"confirmRemoveFavourite"},e)},e.confirmRemoveFavourite=function(){n.removeFavourite(e.favForRemove).then(function(e){r.info("Article removed from favourites"),t.reload("dashboard")},function(e){console.log(e)})},e.getArticleDate=function(e){return a(new Date(Date.parse(e)),"dd/MM/yy HH:mm")}}])}(),function(){angular.module("rssreader").config(["$validatorProvider",function(e){e.addMethod("pattern",function(e,t){return this.optional(t)||/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*(_|[^\w])).{6,20}/.test(e)},"Password must contain(a-z,A-Z,0-9,!@#)")}]).controller("AuthController",["$scope","$state","authService","$window","dashboardService","$auth","transfer","jwtHelper","toasterService",function(e,t,r,a,o,n,i,s,l){e.user={verifyEmail:i.getString(),counter:0},i.setString(""),e.setEmail=function(){return i.getEmail()},e.password={token:i.getObj()},e.confirm_email={},e.session,e.test=5;var c={field_required:"This field is required",email_example:"Please, use example: jacksparrow@gmail.com",min_6symbl:"Please, enter at least 6 characters",min_9symbl:"Please, enter at least 9 characters",max_20symbl:"Please, enter no more then 40 characters",reg_exp:"Password must contain(a-z,A-Z,0-9,!@#)"};e.register=function(a){a.validate()&&(e.user.verifyEmail&&(e.user.email=i.getEmail()),r.register(e.user).error(function(t){e.error=t,"F"===t.message[0]&&l.info(t.message),l.error(t.message)}).then(function(a){console.log(a),l.success("You have successfully registered"),t.go("dashboard."+o.getViewMode(),{id:r.userID()}),e.user.counter++}))},e.logIn=function(n){n.validate()&&(console.log(e.user),r.logIn(e.user,e.session).error(function(t){e.error=t}).then(function(){e.session?(t.go("dashboard."+o.getViewMode(),{id:r.userID()}),l.success("You have successfully login")):(e.onExit=function(){auth.logOut()},t.go("dashboard."+o.getViewMode(),{id:r.userID()}),l.success("You have successfully login"),a.onbeforeunload=e.onExit)}))},e.forgot=function(t){r.forgot(e.confirm_email).error(function(t){e.error=t,l.error(t.message)}).then(function(t){console.log(t.data),l.info("An e-mail has been sent to "+e.confirm_email.email+" with further instructions.")})},e.reset=function(a){r.reset(e.password).error(function(t){e.error=t,l.error(t.message)}).then(function(e){console.log(e.data),l.success("You have successfully changed password"),t.go("login")})},e.authenticate=function(e){i.setProviderString(e),n.authenticate(e).then(function(e){n.removeToken(),r.saveToken(e.data.token),l.success("You have successfully authenticated"),t.go("dashboard."+o.getViewMode())},function(e){l.error(e.data.message)})},e.validationLoginOptions={rules:{mail:{required:!0,email:!0},pwd:{required:!0}},messages:{mail:{required:c.field_required,email:c.email_example},pwd:{required:c.field_required}}},e.validationRegistrOptions={rules:{mail:{required:!0,email:!0,minlength:9,maxlength:40},pwd:{required:!0,minlength:6,maxlength:20,pattern:!0},reppwd:{required:!0}},messages:{mail:{required:c.field_required,email:c.email_example,minlength:c.min_9symbl,maxlength:c.max_20symbl},pwd:{required:c.field_required,minlength:c.min_6symbl,maxlength:c.max_20symbl,pattern:c.reg_exp},reppwd:{required:c.field_required}}}}])}(),function(){"use strict";angular.module("rssreader").controller("DashboardController",["$scope","$state","dashboardService","feedsService","toasterService",function(e,t,r,a,o){a.feedsDictionary.length>0?(r.setTitle("All"),t.go("dashboard."+r.getViewMode())):(r.setTitle("Add Feed"),t.go("dashboard.addFeed")),e.loadingIcon=r.isLoading,e.sidebar=r.checkSidebar,e.headTitle=r.getTitle,e.feed=r.getFeedId,e.alertMsg=r.alertMsg,e.successMsg=r.successMsg,e.toggleSidebar=function(){r.sidebar=!r.sidebar},e.hideSidebar=function(){r.sidebar=!1},e.showSidebar=function(){r.sidebar=!0},e.hideViewBtns=function(){return"Add Feed"===e.headTitle()||0==a.feedsDictionary.length},e.checkIfToggled=function(e){return r.getViewMode()===e},e.onViewChange=function(e){switch(e){case"view-mode1":r.setViewMode(0);break;case"view-mode2":r.setViewMode(1);break;case"view-mode3":r.setViewMode(2)}t.go("dashboard."+r.getViewMode())};e.onFeedDelete=function(){o.confirm({message:"Remove this feed?",confirm:"confirmFeedDelete"},e)},e.confirmFeedDelete=function(){a.removeFeed(r.getFeedId()).then(function(e){o.info("Feed has been deleted"),t.reload("dashboard")},function(e){console.log(e)})},e.setSortParam=function(e,t){console.log(e),console.log(t),r.setSortParam(e,t)}}])}(),function(){"use strict";angular.module("rssreader").controller("FeedsController",["$scope","$state","$http","toasterService","feedsService","dashboardService","articlesService","authService",function(e,t,r,a,o,n,i,s){e.obj={},e.feeds=o.feedsDictionary,e.categories=o.allCategories,e.addingNewCategory=!1,e.newCategory=null,e.checkIfNew=function(){e.obj.category.toUpperCase()=="custom".toUpperCase()?e.addingNewCategory=!0:(e.addingNewCategory=!1,e.newCategory=null)},e.addFeed=function(){e.newCategory&&(e.obj.category=e.newCategory),e.error="",o.addFeed(e.obj).then(function(r){e.addingNewCategory=!1,a.success("Feed successfully added"),t.reload("dashboard")},function(t){t.data?e.error=t.data.message:e.error=t.message})}}])}(),function(){"use strict";angular.module("rssreader").controller("HomeController",["$scope","$state","authService","dashboardService","feedsService",function(e,t,r,a,o){e.isLoggedIn=r.isLoggedIn,e.currentUser=r.currentUser,e.onFeeds=function(){r.isLoggedIn()?t.go("dashboard."+a.getViewMode(),{id:r.userID()}):t.go("home")},e.onFeeds(),e.onRegister=function(){t.go("register")},e.onLogin=function(){t.go("login")}}])}(),function(){angular.module("rssreader").controller("IndexController",["$scope","authService","$window","themeService",function(e,t,r,a){e.layout=a.getTheme,e.text="some text"}])}(),function(){"use strict";angular.module("rssreader").controller("NavbarController",["$scope","$state","profileService","authService","dashboardService","transfer","accountInfo","$auth",function(e,t,r,a,o,n,i,s){e.isLoggedIn=a.isLoggedIn,e.isDashboard=function(){return/dashboard/.test(t.current.name)},e.currentUser=r.refreshProfileData,e.toggleSidebar=function(){angular.element(document.querySelector("#bs-example-navbar-collapse-1")).removeClass("in"),o.sidebar=!o.sidebar,e.getProfile()},e.hideSidebar=function(){o.sidebar=!1},e.logOut=function(){a.logOut(),t.go("home")},e.onEmblem=function(){a.isLoggedIn()?e.isDashboard()?t.reload("dashboard"):t.go("dashboard."+o.getViewMode()):t.go("home")}}])}(),function(){"use strict";angular.module("rssreader").config(["$validatorProvider",function(e){e.addMethod("pattern",function(e,t){return this.optional(t)||/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*(_|[^\w])).{6,20}/.test(e)},"Please specify the correct domain for your documents")}]).controller("ProfileController",["Upload","$http","$state","profileService","$scope","authService","$window","themeService","dashboardService","$auth","accountInfo","toasterService","transfer",function(e,t,r,a,o,n,i,s,l,c,u,d,g){o.currentUser=a.refreshProfileData,o.test=5,o.sameProvider=g.getProviderString(),console.log(o.sameProvider),o.link=function(e){c.link(e).then(function(){d.info("You have successfully linked a "+e+" account"),a.getProfile()},function(e){d.error(e.data.message)})},o.unlink=function(e){t.post("/auth/unlink",{id:a.refreshProfileData()._id,provider:e}).then(function(t){d.info("You have unlinked a "+e+" account"),a.getProfile()})},o.updateProfile=function(){a.getProfile(),console.log(a.getProfile())},o.newUserData={email:a.refreshProfileData().email,currentPass:"",newPass:"",newPassRepeat:""},o.submit=function(){o.upload_form.file.$valid&&o.file&&o.upload(o.file)},o.upload=function(t){console.log(o.file),e.upload({url:"/upload",data:{file:t,user:n.userID()}}).then(function(e){0===e.data.error_code?a.getProfile():d.error("an error occured")},function(e){console.log("Error status: "+e.status),i.alert("Error status: "+e.status)},function(e){console.log(e);var t=parseInt(100*e.loaded/e.total);console.log("progress: "+t+"% "+e.config.data.file.name),o.progress="progress: "+t+"% "})};var f={field_required:"This field is required",email_example:"Please, use example: jacksparrow@gmail.com",min_6symbl:"Please,enter at least 6 characters",min_9symbl:"Please,enter at least 9 characters",max_20symbl:"Please,no more then 20 characters",reg_exp:"Password must contain(a-z,A-Z,0-9,!@#)"};o.changePass=function(e){if(e.validate())return console.log("Submit change password"),t.post("/changePassword",o.newUserData,{headers:{Authorization:"Bearer "+n.getToken()}}).success(function(e){d.success("You have successfully changed pswd"),n.saveToken(e.token),r.go("dashboard."+l.getViewMode(),{id:n.userID()})}).error(function(e){o.err=e,console.log(e.message)})},o.changePassValidation={rules:{currentPassword:{required:!0},newPassword:{required:!0,minlength:6,maxlength:40,pattern:!0},repeatNewPassword:{required:!0}},messages:{currentPassword:{required:f.field_required,email:f.email_example,minlength:f.min_9symbl,maxlength:f.max_20symbl},newPassword:{required:f.field_required,minlength:f.min_6symbl,maxlength:f.max_20symbl,pattern:f.reg_exp},repeatNewPassword:{required:f.field_required}}},o.updateTheme=function(){s.layout=o.layout},o.layout=s.layout,o.layouts=s.layouts}])}(),function(){"use strict";angular.module("rssreader").controller("SidebarController",["$scope","$state","feedsService","articlesService","dashboardService",function(e,t,r,a,o){e.feedsListDragableTypes=["feeds"],e.favsListDragableTypes=["favs"],e.currentArticlesType=o.currentArticlesType,e.currentSelectedItem,e.feeds=r.feedsDictionary,e.favs=r.favouritesDictionary,e.onFeedsDrag=function(t){o.loadingIcon=!0,e.feeds.splice(t,1),r.setFeedsOrder().then(function(e){o.loadingIcon=!1})},e.onFavsDrag=function(t){o.loadingIcon=!0,e.favs.splice(t,1),r.setFavsOrder().then(function(e){o.loadingIcon=!1})},e.getAll=function(r){n(angular.element(r.currentTarget).parent(),"all"),1===e.feeds.length&&1===e.feeds[0].values.length?a.getArticlesByFeed(e.feeds[0].values[0]):a.getAllArticles(),t.go("dashboard."+o.getViewMode())},e.getByFeed=function(e,r){n(angular.element(e.currentTarget).parent()),a.getArticlesByFeed(r),t.go("dashboard."+o.getViewMode())},e.getByCat=function(r,i,s){n(angular.element(r.currentTarget).parent(),"category",i),r.currentTarget.attributes[4]?("true"==r.currentTarget.attributes[4].value&&angular.element(r.currentTarget).removeClass("chevron-down"),"false"==r.currentTarget.attributes[4].value&&angular.element(r.currentTarget).addClass("chevron-down")):angular.element(r.currentTarget).addClass("chevron-down"),1==e.feeds[arguments[2]].values.length?a.getArticlesByFeed(e.feeds[arguments[2]].values[0]):a.getArticlesByCat(arguments[1]),t.go("dashboard."+o.getViewMode())},e.getFavourites=function(e){n(angular.element(e.currentTarget).parent(),"favourites"),e.currentTarget.attributes[4]?("true"==e.currentTarget.attributes[4].value&&angular.element(e.currentTarget).removeClass("chevron-down"),"false"==e.currentTarget.attributes[4].value&&angular.element(e.currentTarget).addClass("chevron-down")):angular.element(e.currentTarget).addClass("chevron-down"),a.getFavourites(),t.go("dashboard."+o.getViewMode())},e.getFavArticlesByCat=function(e,r){n(angular.element(e.currentTarget).parent(),"category",r),e.currentTarget.attributes[4]?("true"==e.currentTarget.attributes[4].value&&angular.element(e.currentTarget).removeClass("chevron-down"),"false"==e.currentTarget.attributes[4].value&&angular.element(e.currentTarget).addClass("chevron-down")):angular.element(e.currentTarget).addClass("chevron-down"),a.getFavArticlesByCat(arguments[1]),t.go("dashboard."+o.getViewMode())},e.getFavArticle=function(e,r){n(angular.element(e.currentTarget).parent()),a.getFavArticle(r),t.go("dashboard."+o.getViewMode())},e.hideFavourites=function(){return e.favs.length},e.checkIfEmpty=function(){return 0!=r.feedsDictionary.length},e.toggle=!1;var n=function(t,r,a){r&&a&&o.setCurrentArticlesType(r,a),e.currentSelectedItem&&e.currentSelectedItem.removeClass("selected"),e.currentSelectedItem=t,e.currentSelectedItem.addClass("selected")}}])}(),angular.module("rssreader").factory("accountInfo",["$http",function(e){return{getProfile:function(){return e.get("/api/me")},updateProfile:function(t){return e.put("/api/me",t)}}}]),function(){"use strict";angular.module("rssreader").factory("articlesService",["$http","$q","authService","$timeout","dashboardService","feedsService",function(e,t,r,a,o,n){var i=50,s={articles:[],isFavourites:!1,checkIfFavourites:function(){return s.isFavourites},getAllArticles:function(){s.isFavourites=!1,s.articles.length=0,o.setTitle("All"),o.resetFeedId(),angular.forEach(n.feedsDictionary,function(e,t){angular.forEach(e.values,function(e,t){return u(e)})})},getArticlesByFeed:function(e){s.articles.length=0,s.isFavourites=!1,o.setTitle(e.title),o.setFeedId(e._id),u(e)},getArticlesByCat:function(e){s.isFavourites=!1,s.articles.length=0,o.setTitle(e),o.resetFeedId(),angular.forEach(n.feedsDictionary,function(t,r){t.key===e&&angular.forEach(t.values,function(e,t){u(e)})})},getFavourites:function(){s.isFavourites=!0,s.articles.length=0,o.setTitle("Favourites"),o.resetFeedId(),angular.forEach(n.favouritesDictionary,function(e,t){angular.forEach(e.values,function(e,t){s.articles.push(e)})})},getFavArticlesByCat:function(e){s.isFavourites=!0,s.articles.length=0,o.setTitle("Favourites: "+e),o.resetFeedId(),angular.forEach(n.favouritesDictionary,function(t,r){t.key===e&&angular.forEach(t.values,function(e,t){s.articles.push(e)})})},getFavArticle:function(e){s.isFavourites=!0,o.setTitle("Favourites"),o.resetFeedId(),s.articles.length=0,s.articles.push(e)},addFavourite:function(t){return e.post("/users/"+r.userID()+"/addFavArticle",t,{headers:{Authorization:"Bearer "+r.getToken()}})},removeFavourite:function(t){return o.loadingIcon=!0,e["delete"]("/users/"+r.userID()+"/deleteFavFeed/"+t._id,{headers:{Authorization:"Bearer "+r.getToken()}}).then(function(e){o.loadingIcon=!1})},getArticlesFetcher:function(){return u}},l=function(e,t){var r="";if("RSS"===t)if(e.getElementsByTagName("enclosure").length)r=e.getElementsByTagName("enclosure")[0].getAttribute("url");else{try{r=$(e).find("media\\:content, content")[0].getAttribute("url")}catch(a){r=""}if(""==r||void 0==r)try{var o=document.createElement("div");o.innerHTML=e.getElementsByTagName("description")[0].textContent,r=$(o).find("img")[0].src}catch(a){r=""}}else if("ATOM"===t&&!e.getElementsByTagName("enclosure").length)try{var o=document.createElement("div");o.innerHTML=e.getElementsByTagName("content")[0].textContent,r=$(o).find("img")[0].src}catch(a){r=""}return r},c=function(e,t){var r="";if("RSS"===t)try{r=document.createElement("div"),r.innerHTML=e.getElementsByTagName("description")[0].textContent,r=$(r).text()}catch(a){}else"ATOM"===t&&(r=$(e.getElementsByTagName("content")[0].childNodes[0].data).text());return r},u=function(t){return e.jsonp("https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num="+i+"&q="+encodeURIComponent(t.rsslink)+"&method=JSONP&callback=JSON_CALLBACK&output=xml").then(function(e){var r=new DOMParser,a=r.parseFromString(e.data.responseData.xmlString,"text/xml"),o=[];if("RSS"===t.format){o=a.getElementsByTagName("item");for(var n=0;n<o.length;n++){var i={title:o[n].getElementsByTagName("title")[0].innerHTML,link:o[n].getElementsByTagName("link")[0].textContent,img:l(o[n],t.format),content:c(o[n],t.format),date:o[n].getElementsByTagName("pubDate")[0].textContent};i.content=i.content||i.title,s.articles.push(i)}}else if("ATOM"===t.format){o=a.getElementsByTagName("entry");for(var n=0;n<o.length;n++){var i={title:o[n].getElementsByTagName("title")[0].textContent,link:o[n].getElementsByTagName("id")[0].textContent,img:l(o[n],t.format),content:c(o[n],t.format),date:o[n].getElementsByTagName("published")[0].textContent};i.content=i.content||i.title,s.articles.push(i)}}return e.data})};return s}])}(),function(){"use strict";angular.module("rssreader").factory("authService",["$http","$window","$auth","transfer","jwtHelper","toasterService","profileService",function(e,t,r,a,o,n,i){var s={saveToken:function(e){r.setToken(e)},getToken:function(){return r.getToken()},isLoggedIn:function(){return r.isAuthenticated()},currentUser:function(){return i.refreshProfileData().email},userID:function(){if(s.isLoggedIn()){var e=r.getPayload();return console.log(e.sub),e.sub}},register:function(t){return e.post("/register",t).success(function(e){s.saveToken(e.token)}).error(function(e){console.log(e.message)})},forgot:function(t){return e.post("/forgot",t).success(function(e){}).error(function(e){console.log(e.message)})},reset:function(t){return e.post("/reset/:token",t).success(function(e){}).error(function(e){console.log(e.message)})},logIn:function(t){return e.post("/login",t).success(function(e){s.saveToken(e.token)}).error(function(e){console.log(e.message)})},logOut:function(){r.removeToken(),r.logout()}};return s}])}(),angular.module("rssreader").service("dashboardService",["$window",function(e){var t=this;this.DEFAULT_VIEW=2,this.currentArticlesType="all",this.currentArticlesValue=e.localStorage.category,this.sortParam={},this.setSortParam=function(e,t){console.log(e),console.log(t),this.sortParam.type=e,this.sortParam.order=t},e.localStorage.articlesType||(e.localStorage.articlesType=t.currentArticlesType),e.localStorage.category&&(currentArticlesValue=e.localStorage.category),this.setCurrentArticlesType=function(r,a){t.currentArticlesValue=null,t.currentArticlesType=r,e.localStorage.articlesType=t.currentArticlesType,a&&(t.currentArticlesValue=a,e.localStorage.category=t.currentArticlesValue)},this.getCurrentArticlesType=function(){return t.currentArticlesType=e.localStorage.articlesType,t.currentArticlesType},e.localStorage.viewMode||(e.localStorage.viewMode=this.DEFAULT_VIEW),this.loadingIcon=!1,this.isLoading=function(){return t.loadingIcon},this.sidebar=!1,this.checkSidebar=function(){return t.sidebar},this.currentViewMode=e.localStorage.viewMode,this.modalShown=!1,this.viewModes=["list","th-list","th-large"],this.resetViewMode=function(){e.localStorage.viewMode=this.DEFAULT_VIEW},this.setViewMode=function(r){if(e.localStorage.viewMode=r,r>t.viewModes.length-1)throw new Error("View mode you are trying to set is not defined");t.currentViewMode=e.localStorage.viewMode},this.getViewMode=function(){return t.currentViewMode=e.localStorage.viewMode,t.viewModes[t.currentViewMode]},this.title="",this.setTitle=function(e){"Add Feed"==e&&this.resetFeedId(),t.title=e},this.getTitle=function(){return t.title},this.currentFeed="",this.getFeedId=function(){return t.currentFeed},this.setFeedId=function(e){t.currentFeed=e},this.resetFeedId=function(){t.currentFeed=""}}]),angular.module("rssreader").service("feedsService",["$http","$state","authService","dashboardService",function(e,t,r,a){that=this,this.feedsDictionary=[],this.favouritesDictionary=[],this.allArticles=[],this.CATEGORIES=["News","IT","Sport","Design","Movies","Music","Culture","Nature","Economics","Science"],this.allCategories=function(){var e=that.CATEGORIES.concat(o());return e.push("Custom"),e},this.allFavsCategories=function(){var e=that.CATEGORIES.concat(n());return e.push("Custom"),e};var o=function(){var e=function(){for(var e=[],t=0;t<that.feedsDictionary.length;t++)e.push(that.feedsDictionary[t].key);return e}();return e.filter(function(e,t,r){return that.CATEGORIES.indexOf(e)==-1})},n=function(){var e=function(){for(var e=[],t=0;t<that.favouritesDictionary.length;t++)e.push(that.favouritesDictionary[t].key);return e}();return e.filter(function(e,t,r){return that.CATEGORIES.indexOf(e)==-1&&"Unsorted"!=e})};this.getAllFeeds=function(){return e.get("/users/"+r.userID(),{headers:{Authorization:"Bearer "+r.getToken()}}).then(function(e){angular.copy(e.data,that.feedsDictionary),that.getAllFavourites().then(function(e){angular.copy(e.data,that.favouritesDictionary)})})},this.getAllFavourites=function(){return e.get("/users/"+r.userID()+"/favourites",{headers:{Authorization:"Bearer "+r.getToken()}})};var i=function(e){return e.getElementsByTagName("rss").length?"RSS":e.getElementsByTagName("feed").length?"ATOM":-1},s=function(e,t,r){var a={};if("RSS"===r){var o=e.getElementsByTagName("channel")[0];a.title=o.getElementsByTagName("title")[0].childNodes[0].nodeValue,a.description=o.getElementsByTagName("description")[0].childNodes[0]?o.getElementsByTagName("description")[0].childNodes[0].nodeValue:"",a.link=o.getElementsByTagName("link")[0].childNodes[0].nodeValue,a.rsslink=t.link,a.category=t.category}else"ATOM"===r&&(a.title=e.getElementsByTagName("title")[0].childNodes[0].nodeValue,a.description="",a.link=e.getElementsByTagName("link")[0].getAttribute("href"),a.rsslink=t.link,a.category=t.category);return a.format=r,a};this.getFeedGenerator=function(){return s},this.getRssChecker=function(){return i},this.addFeed=function(t){return e.jsonp("https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=10&q="+encodeURIComponent(t.link)+"&method=JSON&callback=JSON_CALLBACK&output=xml").then(function(a){if(void 0===t.link)throw new Error("Enter Rss feed link");if(void 0===t.category)throw new Error("Choose category");if(null===a.data.responseData)throw new Error("URL is incorrect or does not contain RSS Feed data");var o=new DOMParser;xmlDoc=o.parseFromString(a.data.responseData.xmlString,"text/xml");var n=i(xmlDoc);if(n===-1)throw new Error("URL is incorrect or does not contain RSS Feed data");var l=s(xmlDoc,t,n);return e.post("/users/"+r.userID()+"/addFeed",l,{headers:{Authorization:"Bearer "+r.getToken()}})})},this.removeFeed=function(t){return e["delete"]("/users/"+r.userID()+"/deleteFeed/"+t,{headers:{Authorization:"Bearer "+r.getToken()}})},this.setFeedsOrder=function(){for(var t={newCategories:[]},a=0;a<that.feedsDictionary.length;a++)t.newCategories.push(that.feedsDictionary[a].key);return e.post("/users/"+r.userID()+"/setCategoryOrder",t,{headers:{Authorization:"Bearer "+r.getToken()}})},this.setFavsOrder=function(){for(var t={newCategories:[]},a=0;a<that.favouritesDictionary.length;a++)t.newCategories.push(that.favouritesDictionary[a].key);return e.post("/users/"+r.userID()+"/setFavsCategoryOrder",t,{headers:{Authorization:"Bearer "+r.getToken()}})}}]),function(){"use strict";angular.module("rssreader").factory("profileService",["$window","Upload","accountInfo","$auth",function(e,t,r,a){var o={profile:{},getProfile:function(){if(a.isAuthenticated())return r.getProfile().then(function(e){for(var t=e.data.user.length,r=0;r<t;r++)e.data.user[r].email===a.getPayload().email&&(o.profile=e.data.user[r])})},refreshProfileData:function(){return o.profile}};return o}])}(),angular.module("rssreader").service("themeService",["authService","$window",function(e,t){that=this,this.layout="style",this.getTheme=function(){return void 0!==that.layout?that.layout:"style"},this.layouts=[{name:"Blue",url:"style"},{name:"Black",url:"style2"},{name:"Grey",url:"style3"}]}]),function(){"use strict";angular.module("rssreader").service("toasterService",["$rootScope","$compile","$animate",function(e,t,r){var a=angular.element("body"),o=function(o,n,i){var s=arguments[2],l=angular.element(document.createElement("toaster"));l.addClass("toaster-wrapper"),l.addClass(o.type),o.overlay&&l.attr("overlay",o.overlay),o.delay&&l.attr("delay",o.delay),o.confirm&&l.attr("confirm",o.confirm);var c=angular.element(document.createElement("div"));c.addClass("toaster-icon"),c.addClass(o.iconClass),l.append(c),l.append("<span>"+o.message+"</span>"),o.htmlContent&&l.append("<span>"+o.htmlContent+"</span>");var u;u="object"==typeof arguments[1]?t(l,n)(n.$new()):t(l,n)(e.$new()),r.enter(u,a).then(function(){"function"==typeof s&&i()})};this.success=function(e,t,r,a){var n,i={message:e,type:"toaster-success",iconClass:"fa fa-check",delay:3e3};n="object"==typeof t?angular.extend({},i,t):i,o(n,r,a)},this.info=function(e,t,r,a){var n,i={message:e,type:"toaster-info",iconClass:"fa fa-info",delay:3e3};n="object"==typeof arguments[1]?angular.extend({},i,t):i,o(n,r,a)},this.error=function(e,t,r,a){var n,i={message:e,type:"toaster-error",iconClass:"fa fa-exclamation-triangle",delay:3e3};n="object"==typeof arguments[1]?angular.extend({},i,t):i,o(n,r,a)},this.custom=function(e,t,r){var a,n={message:message,type:"toaster-default",overlay:!0,iconClass:"fa fa-info"};a="object"==typeof arguments[0]?angular.extend({},n,e):n,o(a,t,r)},this.confirm=function(e,t,r){var a,n={message:"Confirm?",type:"toaster-default",overlay:!0,iconClass:"fa fa-question",
htmlContent:"<button class='app-btn-toaster-red' aria-label='Justify' ng-click='confirm()'>yes</button><button class='app-btn-toaster' aria-label='Justify' ng-click='reject()'>no</button>"};a="object"==typeof e?angular.extend({},n,e):n,o(a,t,r)},this.removeToaster=function(e){r.leave(e,a).then(function(){})}}])}(),angular.module("rssreader").factory("transfer",[function(){function e(e){d=e}function t(){return d}function r(e){u=e}function a(){return u}function o(e){c=e}function n(){return c}function i(e){l=e}function s(){return l}var l={},c="",u="",d="";return{setObj:i,getObj:s,setString:o,getString:n,setProviderString:r,getProviderString:a,setEmail:e,getEmail:t}}]),function(){"use strict";angular.module("rssreader",["ui.router","ngAnimate","ngValidate","ngFileUpload","ngTouch","favicon","dndLists","satellizer","angular-jwt","720kb.socialshare","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$authProvider",function(e,t,r){t.otherwise("home"),e.state("home",{url:"/home",templateUrl:"./partials/home.html",controller:"HomeController"}).state("login",{url:"/login",templateUrl:"./partials/auth/login.html",controller:"AuthController",onEnter:["$state","authService",function(e,t){t.isLoggedIn()&&e.go("home")}]}).state("register",{url:"/register",templateUrl:"./partials/auth/register.html",controller:"AuthController",onEnter:["$state","authService",function(e,t){t.isLoggedIn()&&e.go("home")}]}).state("forgot",{url:"/forgot",templateUrl:"./partials/auth/forgot.html",controller:"AuthController"}).state("reset",{url:"/reset/:token",templateUrl:"./partials/auth/reset.html",controller:"AuthController",onEnter:["$stateParams","transfer",function(e,t){t.setObj(e.token)}]}).state("verify",{url:"/verify/:token/:email",templateUrl:"./partials/auth/verify.html",controller:"AuthController",onEnter:["$stateParams","transfer","toasterService",function(e,t,r){t.setEmail(e.email),t.setString(e.token),console.log(e),r.info("You have successfuly approved you email. Please reenter you fields")}]}).state("profile",{url:"/profile",templateUrl:"./partials/auth/profile.html",controller:"ProfileController",resolve:{profilePromise:["profileService",function(e){return e.getProfile()}]},onEnter:["$state","authService",function(e,t){t.isLoggedIn()||(t.logOut(),e.go("home"))}]}).state("dashboard",{url:"/dashboard",views:{"":{templateUrl:"./partials/dashboard/dashboard.html",controller:"DashboardController"},"sidebar@dashboard":{templateUrl:"./partials/dashboard/sidebar.html",controller:"SidebarController"},"feedHead@dashboard":{templateUrl:"./partials/dashboard/feed-head.html",controller:"DashboardController"}},resolve:{profilePromise:["profileService",function(e){return e.getProfile()}],feedPromise:["feedsService",function(e){return e.getAllFeeds()}]},onEnter:["articlesService","dashboardService",function(e,t){e.getAllArticles()}]}).state("dashboard.list",{url:"/list",templateUrl:"./partials/list/list.html",controller:"ArticlesController"}).state("dashboard.th-list",{url:"/th-list",templateUrl:"./partials/list/th-list.html",controller:"ArticlesController"}).state("dashboard.th-large",{url:"/th-large",templateUrl:"./partials/list/th-large.html",controller:"ArticlesController"}).state("dashboard.addFeed",{url:"/add",templateUrl:"./partials/dashboard/add-feed.html",controller:"FeedsController",onEnter:["dashboardService",function(e){e.setTitle("Add Feed")}]}),r.twitter({clientId:"768721225971560448",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:"http://localhost:8080",oauthType:"1.0",popupOptions:{width:495,height:645}}),r.linkedin({clientId:"78ffzenowt180q",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:"http://localhost:8080",requiredUrlParams:["state"],scopeDelimiter:" ",state:"STATE",oauthType:"2.0",popupOptions:{width:527,height:582}}),r.facebook({clientId:"173686319709284",name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:window.location.origin+"/",requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",oauthType:"2.0",popupOptions:{width:580,height:400}}),r.google({clientId:"806677097865-va2i3kq96mmu8i00t9k6q92ks1s9tg0l.apps.googleusercontent.com",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:"http://localhost:8080",requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:452,height:633}})}])}(),function(){"use strict";angular.module("rssreader").controller("ArticlesController",["$scope","$state","toasterService","dateFilter","feedsService","articlesService","dashboardService",function(e,t,r,a,o,n,i){e.obj={},e.newCatObj={},e.categories=o.allFavsCategories,e.error=null,e.modalShown=!1,e.articles=n.articles,e.isFavourites=n.checkIfFavourites,e.favForAdd={},e.favForRemove={},e.articleForShare={},e.sortParam=i.sortParam,e.addingNewFavCategory=!1,e.getSortParam=function(){return e.sortParam=i.sortParam,e.sortParam},e.checkIfNew=function(){e.obj.category.toUpperCase()=="custom".toUpperCase()?e.addingNewFavCategory=!0:(e.addingNewFavCategory=!1,e.newCatObj.category=null)},e.addFavourite=function(t){e.error=null,e.modalShown=!e.modalShown,e.favForAdd=t},e.confirmAddFavourite=function(){e.newCatObj.category&&(e.obj.category=e.newCatObj.category),e.favForAdd.category=e.obj.category,n.addFavourite(e.favForAdd).then(function(a){e.addingNewCategory=!1,r.success("Article marked as favourite"),t.reload("dashboard")},function(t){console.log(t),t.data?e.error=t.data.message:e.error=t.message})},e.cancelAddFavourite=function(){e.modalShown=!1,e.favForAdd={}},e.share=function(t){e.error=null,e.articleForShare=t},e.cancelSharing=function(){e.modalShareShown=!1,e.articleForShare={}},e.removeFavourite=function(t){e.favForRemove=t,r.confirm({message:"Remove this article?",confirm:"confirmRemoveFavourite"},e)},e.confirmRemoveFavourite=function(){n.removeFavourite(e.favForRemove).then(function(e){r.info("Article removed from favourites"),t.reload("dashboard")},function(e){console.log(e)})},e.getArticleDate=function(e){return a(new Date(Date.parse(e)),"dd/MM/yy HH:mm")}}])}(),function(){angular.module("rssreader").config(["$validatorProvider",function(e){e.addMethod("pattern",function(e,t){return this.optional(t)||/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*(_|[^\w])).{6,20}/.test(e)},"Password must contain(a-z,A-Z,0-9,!@#)")}]).controller("AuthController",["$scope","$state","authService","$window","dashboardService","$auth","transfer","jwtHelper","toasterService",function(e,t,r,a,o,n,i,s,l){e.user={verifyEmail:i.getString(),counter:0},i.setString(""),e.setEmail=function(){return i.getEmail()},e.password={token:i.getObj()},e.confirm_email={},e.session,e.test=5;var c={field_required:"This field is required",email_example:"Please, use example: jacksparrow@gmail.com",min_6symbl:"Please, enter at least 6 characters",min_9symbl:"Please, enter at least 9 characters",max_20symbl:"Please, enter no more then 40 characters",reg_exp:"Password must contain(a-z,A-Z,0-9,!@#)"};e.register=function(a){a.validate()&&(e.user.verifyEmail&&(e.user.email=i.getEmail()),r.register(e.user).error(function(t){e.error=t,"F"===t.message[0]&&l.info(t.message),l.error(t.message)}).then(function(a){console.log(a),l.success("You have successfully registered"),t.go("dashboard."+o.getViewMode(),{id:r.userID()}),e.user.counter++}))},e.logIn=function(n){n.validate()&&(console.log(e.user),r.logIn(e.user,e.session).error(function(t){e.error=t}).then(function(){e.session?(t.go("dashboard."+o.getViewMode(),{id:r.userID()}),l.success("You have successfully login")):(e.onExit=function(){auth.logOut()},t.go("dashboard."+o.getViewMode(),{id:r.userID()}),l.success("You have successfully login"),a.onbeforeunload=e.onExit)}))},e.forgot=function(t){r.forgot(e.confirm_email).error(function(t){e.error=t,l.error(t.message)}).then(function(t){console.log(t.data),l.info("An e-mail has been sent to "+e.confirm_email.email+" with further instructions.")})},e.reset=function(a){r.reset(e.password).error(function(t){e.error=t,l.error(t.message)}).then(function(e){console.log(e.data),l.success("You have successfully changed password"),t.go("login")})},e.authenticate=function(e){i.setProviderString(e),n.authenticate(e).then(function(e){n.removeToken(),r.saveToken(e.data.token),l.success("You have successfully authenticated"),t.go("dashboard."+o.getViewMode())},function(e){l.error(e.data.message)})},e.validationLoginOptions={rules:{mail:{required:!0,email:!0},pwd:{required:!0}},messages:{mail:{required:c.field_required,email:c.email_example},pwd:{required:c.field_required}}},e.validationRegistrOptions={rules:{mail:{required:!0,email:!0,minlength:9,maxlength:40},pwd:{required:!0,minlength:6,maxlength:20,pattern:!0},reppwd:{required:!0}},messages:{mail:{required:c.field_required,email:c.email_example,minlength:c.min_9symbl,maxlength:c.max_20symbl},pwd:{required:c.field_required,minlength:c.min_6symbl,maxlength:c.max_20symbl,pattern:c.reg_exp},reppwd:{required:c.field_required}}}}])}(),function(){"use strict";angular.module("rssreader").controller("DashboardController",["$scope","$state","dashboardService","feedsService","toasterService",function(e,t,r,a,o){a.feedsDictionary.length>0?(r.setTitle("All"),t.go("dashboard."+r.getViewMode())):(r.setTitle("Add Feed"),t.go("dashboard.addFeed")),e.loadingIcon=r.isLoading,e.sidebar=r.checkSidebar,e.headTitle=r.getTitle,e.feed=r.getFeedId,e.alertMsg=r.alertMsg,e.successMsg=r.successMsg,e.toggleSidebar=function(){r.sidebar=!r.sidebar},e.hideSidebar=function(){r.sidebar=!1},e.showSidebar=function(){r.sidebar=!0},e.hideViewBtns=function(){return"Add Feed"===e.headTitle()||0==a.feedsDictionary.length},e.checkIfToggled=function(e){return r.getViewMode()===e},e.onViewChange=function(e){switch(e){case"view-mode1":r.setViewMode(0);break;case"view-mode2":r.setViewMode(1);break;case"view-mode3":r.setViewMode(2)}t.go("dashboard."+r.getViewMode())};e.onFeedDelete=function(){o.confirm({message:"Remove this feed?",confirm:"confirmFeedDelete"},e)},e.confirmFeedDelete=function(){a.removeFeed(r.getFeedId()).then(function(e){o.info("Feed has been deleted"),t.reload("dashboard")},function(e){console.log(e)})},e.setSortParam=function(e,t){console.log(e),console.log(t),r.setSortParam(e,t)}}])}(),function(){"use strict";angular.module("rssreader").controller("FeedsController",["$scope","$state","$http","toasterService","feedsService","dashboardService","articlesService","authService",function(e,t,r,a,o,n,i,s){e.obj={},e.feeds=o.feedsDictionary,e.categories=o.allCategories,e.addingNewCategory=!1,e.newCategory=null,e.checkIfNew=function(){e.obj.category.toUpperCase()=="custom".toUpperCase()?e.addingNewCategory=!0:(e.addingNewCategory=!1,e.newCategory=null)},e.addFeed=function(){e.newCategory&&(e.obj.category=e.newCategory),e.error="",o.addFeed(e.obj).then(function(r){e.addingNewCategory=!1,a.success("Feed successfully added"),t.reload("dashboard")},function(t){t.data?e.error=t.data.message:e.error=t.message})}}])}(),function(){"use strict";angular.module("rssreader").controller("HomeController",["$scope","$state","authService","dashboardService","feedsService",function(e,t,r,a,o){e.isLoggedIn=r.isLoggedIn,e.currentUser=r.currentUser,e.onFeeds=function(){r.isLoggedIn()?t.go("dashboard."+a.getViewMode(),{id:r.userID()}):t.go("home")},e.onFeeds(),e.onRegister=function(){t.go("register")},e.onLogin=function(){t.go("login")}}])}(),function(){angular.module("rssreader").controller("IndexController",["$scope","authService","$window","themeService",function(e,t,r,a){e.layout=a.getTheme,e.text="some text"}])}(),function(){"use strict";angular.module("rssreader").controller("NavbarController",["$scope","$state","profileService","authService","dashboardService","transfer","accountInfo","$auth",function(e,t,r,a,o,n,i,s){e.isLoggedIn=a.isLoggedIn,e.isDashboard=function(){return/dashboard/.test(t.current.name)},e.currentUser=r.refreshProfileData,e.toggleSidebar=function(){angular.element(document.querySelector("#bs-example-navbar-collapse-1")).removeClass("in"),o.sidebar=!o.sidebar,e.getProfile()},e.hideSidebar=function(){o.sidebar=!1},e.logOut=function(){a.logOut(),t.go("home")},e.onEmblem=function(){a.isLoggedIn()?e.isDashboard()?t.reload("dashboard"):t.go("dashboard."+o.getViewMode()):t.go("home")}}])}(),function(){"use strict";angular.module("rssreader").config(["$validatorProvider",function(e){e.addMethod("pattern",function(e,t){return this.optional(t)||/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*(_|[^\w])).{6,20}/.test(e)},"Please specify the correct domain for your documents")}]).controller("ProfileController",["Upload","$http","$state","profileService","$scope","authService","$window","themeService","dashboardService","$auth","accountInfo","toasterService","transfer",function(e,t,r,a,o,n,i,s,l,c,u,d,g){o.currentUser=a.refreshProfileData,o.test=5,o.sameProvider=g.getProviderString(),console.log(o.sameProvider),o.link=function(e){c.link(e).then(function(){d.info("You have successfully linked a "+e+" account"),a.getProfile()},function(e){d.error(e.data.message)})},o.unlink=function(e){t.post("/auth/unlink",{id:a.refreshProfileData()._id,provider:e}).then(function(t){d.info("You have unlinked a "+e+" account"),a.getProfile()})},o.updateProfile=function(){a.getProfile(),console.log(a.getProfile())},o.newUserData={email:a.refreshProfileData().email,currentPass:"",newPass:"",newPassRepeat:""},o.submit=function(){o.upload_form.file.$valid&&o.file&&o.upload(o.file)},o.upload=function(t){console.log(o.file),e.upload({url:"/upload",data:{file:t,user:n.userID()}}).then(function(e){0===e.data.error_code?a.getProfile():d.error("an error occured")},function(e){console.log("Error status: "+e.status),i.alert("Error status: "+e.status)},function(e){console.log(e);var t=parseInt(100*e.loaded/e.total);console.log("progress: "+t+"% "+e.config.data.file.name),o.progress="progress: "+t+"% "})};var f={field_required:"This field is required",email_example:"Please, use example: jacksparrow@gmail.com",min_6symbl:"Please,enter at least 6 characters",min_9symbl:"Please,enter at least 9 characters",max_20symbl:"Please,no more then 20 characters",reg_exp:"Password must contain(a-z,A-Z,0-9,!@#)"};o.changePass=function(e){if(e.validate())return console.log("Submit change password"),t.post("/changePassword",o.newUserData,{headers:{Authorization:"Bearer "+n.getToken()}}).success(function(e){d.success("You have successfully changed pswd"),n.saveToken(e.token),r.go("dashboard."+l.getViewMode(),{id:n.userID()})}).error(function(e){o.err=e,console.log(e.message)})},o.changePassValidation={rules:{currentPassword:{required:!0},newPassword:{required:!0,minlength:6,maxlength:40,pattern:!0},repeatNewPassword:{required:!0}},messages:{currentPassword:{required:f.field_required,email:f.email_example,minlength:f.min_9symbl,maxlength:f.max_20symbl},newPassword:{required:f.field_required,minlength:f.min_6symbl,maxlength:f.max_20symbl,pattern:f.reg_exp},repeatNewPassword:{required:f.field_required}}},o.updateTheme=function(){s.layout=o.layout},o.layout=s.layout,o.layouts=s.layouts}])}(),function(){"use strict";angular.module("rssreader").controller("SidebarController",["$scope","$state","feedsService","articlesService","dashboardService",function(e,t,r,a,o){e.feedsListDragableTypes=["feeds"],e.favsListDragableTypes=["favs"],e.currentArticlesType=o.currentArticlesType,e.currentSelectedItem,e.feeds=r.feedsDictionary,e.favs=r.favouritesDictionary,e.onFeedsDrag=function(t){o.loadingIcon=!0,e.feeds.splice(t,1),r.setFeedsOrder().then(function(e){o.loadingIcon=!1})},e.onFavsDrag=function(t){o.loadingIcon=!0,e.favs.splice(t,1),r.setFavsOrder().then(function(e){o.loadingIcon=!1})},e.getAll=function(r){n(angular.element(r.currentTarget).parent(),"all"),1===e.feeds.length&&1===e.feeds[0].values.length?a.getArticlesByFeed(e.feeds[0].values[0]):a.getAllArticles(),t.go("dashboard."+o.getViewMode())},e.getByFeed=function(e,r){n(angular.element(e.currentTarget).parent()),a.getArticlesByFeed(r),t.go("dashboard."+o.getViewMode())},e.getByCat=function(r,i,s){n(angular.element(r.currentTarget).parent(),"category",i),r.currentTarget.attributes[4]?("true"==r.currentTarget.attributes[4].value&&angular.element(r.currentTarget).removeClass("chevron-down"),"false"==r.currentTarget.attributes[4].value&&angular.element(r.currentTarget).addClass("chevron-down")):angular.element(r.currentTarget).addClass("chevron-down"),1==e.feeds[arguments[2]].values.length?a.getArticlesByFeed(e.feeds[arguments[2]].values[0]):a.getArticlesByCat(arguments[1]),t.go("dashboard."+o.getViewMode())},e.getFavourites=function(e){n(angular.element(e.currentTarget).parent(),"favourites"),e.currentTarget.attributes[4]?("true"==e.currentTarget.attributes[4].value&&angular.element(e.currentTarget).removeClass("chevron-down"),"false"==e.currentTarget.attributes[4].value&&angular.element(e.currentTarget).addClass("chevron-down")):angular.element(e.currentTarget).addClass("chevron-down"),a.getFavourites(),t.go("dashboard."+o.getViewMode())},e.getFavArticlesByCat=function(e,r){n(angular.element(e.currentTarget).parent(),"category",r),e.currentTarget.attributes[4]?("true"==e.currentTarget.attributes[4].value&&angular.element(e.currentTarget).removeClass("chevron-down"),"false"==e.currentTarget.attributes[4].value&&angular.element(e.currentTarget).addClass("chevron-down")):angular.element(e.currentTarget).addClass("chevron-down"),a.getFavArticlesByCat(arguments[1]),t.go("dashboard."+o.getViewMode())},e.getFavArticle=function(e,r){n(angular.element(e.currentTarget).parent()),a.getFavArticle(r),t.go("dashboard."+o.getViewMode())},e.hideFavourites=function(){return e.favs.length},e.checkIfEmpty=function(){return 0!=r.feedsDictionary.length},e.toggle=!1;var n=function(t,r,a){r&&a&&o.setCurrentArticlesType(r,a),e.currentSelectedItem&&e.currentSelectedItem.removeClass("selected"),e.currentSelectedItem=t,e.currentSelectedItem.addClass("selected")}}])}(),angular.module("rssreader").directive("modal",[function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(e,t,r){e.modalStyle={},e.hideModal=function(){e.show=!1}},templateUrl:"../partials/modals/modal.html"}}]),angular.module("rssreader").directive("pwCheck",[function(){return{require:"ngModel",link:function(e,t,r,a){var o="#"+r.pwCheck;t.add(o).on("keyup",function(){e.$apply(function(){if(""!==t.val()){var e=t.val()===$(o).val();a.$setValidity("pwmatch",e)}})})}}}]),angular.module("rssreader").directive("checkStrength",[function(){return{replace:!1,restrict:"EACM",link:function(e,t,r){var a={colors:["#F00","#F90","#FF0","#9F0","#0F0"],mesureStrength:function(t){if(t){var r=0,a=/[#@$-\/:-?-~!"^_`]/g,o=/[a-z]+/.test(t),n=/[A-Z]+/.test(t),i=/[0-9]+/.test(t),s=a.test(t),l=[o,n,i,s],c=$.grep(l,function(e){return e===!0}).length;return r+=2*t.length+(t.length>=10?1:0),r+=10*c,r=t.length<=5?Math.min(r,10):r,r=1==c?Math.min(r,10):r,r=2==c?Math.min(r,20):r,r=3==c?Math.min(r,40):r}return e.user.password=""},getColor:function(e){var t=0;return t=e<=10?0:e<=20?1:e<=30?2:e<=40?3:4,{idx:t+1,col:this.colors[t]}}};e.$watch(r.checkStrength,function(){if(""===e.user.password&&t.css({display:"none"}),""===e.password.pas)t.css({display:"none"});else{var r=a.getColor(a.mesureStrength(e.user.password||e.password.pas));t.css({display:"block"}),t.children("li").css({background:"#DDD"}).slice(0,r.idx).css({background:r.col})}})},template:'<li class="point"></li><li class="point"></li><li class="point"></li><li class="point"></li><li class="point"></li>'}}]),angular.module("rssreader").directive("toaster",["$timeout","toasterService",function(e,t){return{restrict:"E",transclude:!0,link:function(r,a,o){o.overlay?r.overlay=!0:r.overlay=!1,o.delay?r.delay=o.delay:r.delay=5e3,r.toasterStyle={},r.confirm=function(){r.$parent[o.confirm](),r.hideToaster()},r.reject=function(){r.hideToaster()},r.hideToaster=function(){e.cancel(r.timer),r.$destroy(),t.removeToaster(a)},r.timer=e(function(){r.hideToaster()},r.delay)},templateUrl:"../partials/modals/toaster.html"}}]),angular.module("rssreader").factory("accountInfo",["$http",function(e){return{getProfile:function(){return e.get("/api/me")},updateProfile:function(t){return e.put("/api/me",t)}}}]),function(){"use strict";angular.module("rssreader").factory("articlesService",["$http","$q","authService","$timeout","dashboardService","feedsService",function(e,t,r,a,o,n){var i=50,s={articles:[],isFavourites:!1,checkIfFavourites:function(){return s.isFavourites},getAllArticles:function(){s.isFavourites=!1,s.articles.length=0,o.setTitle("All"),o.resetFeedId(),angular.forEach(n.feedsDictionary,function(e,t){angular.forEach(e.values,function(e,t){return u(e)})})},getArticlesByFeed:function(e){s.articles.length=0,s.isFavourites=!1,o.setTitle(e.title),o.setFeedId(e._id),u(e)},getArticlesByCat:function(e){s.isFavourites=!1,s.articles.length=0,o.setTitle(e),o.resetFeedId(),angular.forEach(n.feedsDictionary,function(t,r){t.key===e&&angular.forEach(t.values,function(e,t){u(e)})})},getFavourites:function(){s.isFavourites=!0,s.articles.length=0,o.setTitle("Favourites"),o.resetFeedId(),angular.forEach(n.favouritesDictionary,function(e,t){angular.forEach(e.values,function(e,t){s.articles.push(e)})})},getFavArticlesByCat:function(e){s.isFavourites=!0,s.articles.length=0,o.setTitle("Favourites: "+e),o.resetFeedId(),angular.forEach(n.favouritesDictionary,function(t,r){t.key===e&&angular.forEach(t.values,function(e,t){s.articles.push(e)})})},getFavArticle:function(e){s.isFavourites=!0,o.setTitle("Favourites"),o.resetFeedId(),s.articles.length=0,s.articles.push(e)},addFavourite:function(t){return e.post("/users/"+r.userID()+"/addFavArticle",t,{headers:{Authorization:"Bearer "+r.getToken()}})},removeFavourite:function(t){return o.loadingIcon=!0,e["delete"]("/users/"+r.userID()+"/deleteFavFeed/"+t._id,{headers:{Authorization:"Bearer "+r.getToken()}}).then(function(e){o.loadingIcon=!1})},getArticlesFetcher:function(){return u}},l=function(e,t){var r="";if("RSS"===t)if(e.getElementsByTagName("enclosure").length)r=e.getElementsByTagName("enclosure")[0].getAttribute("url");else{try{r=$(e).find("media\\:content, content")[0].getAttribute("url")}catch(a){r=""}if(""==r||void 0==r)try{var o=document.createElement("div");o.innerHTML=e.getElementsByTagName("description")[0].textContent,r=$(o).find("img")[0].src}catch(a){r=""}}else if("ATOM"===t&&!e.getElementsByTagName("enclosure").length)try{var o=document.createElement("div");o.innerHTML=e.getElementsByTagName("content")[0].textContent,r=$(o).find("img")[0].src}catch(a){r=""}return r},c=function(e,t){var r="";if("RSS"===t)try{r=document.createElement("div"),r.innerHTML=e.getElementsByTagName("description")[0].textContent,r=$(r).text()}catch(a){}else"ATOM"===t&&(r=$(e.getElementsByTagName("content")[0].childNodes[0].data).text());return r},u=function(t){return e.jsonp("https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num="+i+"&q="+encodeURIComponent(t.rsslink)+"&method=JSONP&callback=JSON_CALLBACK&output=xml").then(function(e){var r=new DOMParser,a=r.parseFromString(e.data.responseData.xmlString,"text/xml"),o=[];if("RSS"===t.format){o=a.getElementsByTagName("item");for(var n=0;n<o.length;n++){var i={title:o[n].getElementsByTagName("title")[0].innerHTML,link:o[n].getElementsByTagName("link")[0].textContent,img:l(o[n],t.format),content:c(o[n],t.format),date:o[n].getElementsByTagName("pubDate")[0].textContent};i.content=i.content||i.title,s.articles.push(i)}}else if("ATOM"===t.format){o=a.getElementsByTagName("entry");for(var n=0;n<o.length;n++){var i={title:o[n].getElementsByTagName("title")[0].textContent,link:o[n].getElementsByTagName("id")[0].textContent,img:l(o[n],t.format),content:c(o[n],t.format),date:o[n].getElementsByTagName("published")[0].textContent};i.content=i.content||i.title,s.articles.push(i)}}return e.data})};return s}])}(),function(){"use strict";angular.module("rssreader").factory("authService",["$http","$window","$auth","transfer","jwtHelper","toasterService","profileService",function(e,t,r,a,o,n,i){var s={saveToken:function(e){r.setToken(e)},getToken:function(){return r.getToken()},isLoggedIn:function(){return r.isAuthenticated()},currentUser:function(){return i.refreshProfileData().email},userID:function(){if(s.isLoggedIn()){var e=r.getPayload();return console.log(e.sub),e.sub}},register:function(t){return e.post("/register",t).success(function(e){s.saveToken(e.token)}).error(function(e){console.log(e.message)})},forgot:function(t){return e.post("/forgot",t).success(function(e){}).error(function(e){console.log(e.message)})},reset:function(t){return e.post("/reset/:token",t).success(function(e){}).error(function(e){console.log(e.message)})},logIn:function(t){return e.post("/login",t).success(function(e){s.saveToken(e.token)}).error(function(e){console.log(e.message)})},logOut:function(){r.removeToken(),r.logout()}};return s}])}(),angular.module("rssreader").service("dashboardService",["$window",function(e){var t=this;this.DEFAULT_VIEW=2,this.currentArticlesType="all",this.currentArticlesValue=e.localStorage.category,this.sortParam={},this.setSortParam=function(e,t){console.log(e),console.log(t),this.sortParam.type=e,this.sortParam.order=t},e.localStorage.articlesType||(e.localStorage.articlesType=t.currentArticlesType),e.localStorage.category&&(currentArticlesValue=e.localStorage.category),this.setCurrentArticlesType=function(r,a){t.currentArticlesValue=null,t.currentArticlesType=r,e.localStorage.articlesType=t.currentArticlesType,a&&(t.currentArticlesValue=a,e.localStorage.category=t.currentArticlesValue)},this.getCurrentArticlesType=function(){return t.currentArticlesType=e.localStorage.articlesType,t.currentArticlesType},e.localStorage.viewMode||(e.localStorage.viewMode=this.DEFAULT_VIEW),this.loadingIcon=!1,this.isLoading=function(){return t.loadingIcon},this.sidebar=!1,this.checkSidebar=function(){return t.sidebar},this.currentViewMode=e.localStorage.viewMode,this.modalShown=!1,this.viewModes=["list","th-list","th-large"],this.resetViewMode=function(){e.localStorage.viewMode=this.DEFAULT_VIEW},this.setViewMode=function(r){if(e.localStorage.viewMode=r,r>t.viewModes.length-1)throw new Error("View mode you are trying to set is not defined");t.currentViewMode=e.localStorage.viewMode},this.getViewMode=function(){return t.currentViewMode=e.localStorage.viewMode,t.viewModes[t.currentViewMode]},this.title="",this.setTitle=function(e){"Add Feed"==e&&this.resetFeedId(),t.title=e},this.getTitle=function(){return t.title},this.currentFeed="",this.getFeedId=function(){return t.currentFeed},this.setFeedId=function(e){t.currentFeed=e},this.resetFeedId=function(){t.currentFeed=""}}]),angular.module("rssreader").service("feedsService",["$http","$state","authService","dashboardService",function(e,t,r,a){that=this,this.feedsDictionary=[],this.favouritesDictionary=[],this.allArticles=[],this.CATEGORIES=["News","IT","Sport","Design","Movies","Music","Culture","Nature","Economics","Science"],this.allCategories=function(){var e=that.CATEGORIES.concat(o());return e.push("Custom"),e},this.allFavsCategories=function(){var e=that.CATEGORIES.concat(n());return e.push("Custom"),e};var o=function(){var e=function(){for(var e=[],t=0;t<that.feedsDictionary.length;t++)e.push(that.feedsDictionary[t].key);return e}();return e.filter(function(e,t,r){return that.CATEGORIES.indexOf(e)==-1})},n=function(){var e=function(){for(var e=[],t=0;t<that.favouritesDictionary.length;t++)e.push(that.favouritesDictionary[t].key);return e}();return e.filter(function(e,t,r){return that.CATEGORIES.indexOf(e)==-1&&"Unsorted"!=e})};this.getAllFeeds=function(){return e.get("/users/"+r.userID(),{headers:{Authorization:"Bearer "+r.getToken()}}).then(function(e){angular.copy(e.data,that.feedsDictionary),that.getAllFavourites().then(function(e){angular.copy(e.data,that.favouritesDictionary)})})},this.getAllFavourites=function(){return e.get("/users/"+r.userID()+"/favourites",{headers:{Authorization:"Bearer "+r.getToken()}})};var i=function(e){return e.getElementsByTagName("rss").length?"RSS":e.getElementsByTagName("feed").length?"ATOM":-1},s=function(e,t,r){var a={};if("RSS"===r){var o=e.getElementsByTagName("channel")[0];a.title=o.getElementsByTagName("title")[0].childNodes[0].nodeValue,a.description=o.getElementsByTagName("description")[0].childNodes[0]?o.getElementsByTagName("description")[0].childNodes[0].nodeValue:"",a.link=o.getElementsByTagName("link")[0].childNodes[0].nodeValue,a.rsslink=t.link,a.category=t.category}else"ATOM"===r&&(a.title=e.getElementsByTagName("title")[0].childNodes[0].nodeValue,a.description="",a.link=e.getElementsByTagName("link")[0].getAttribute("href"),a.rsslink=t.link,a.category=t.category);return a.format=r,a};this.getFeedGenerator=function(){return s},this.getRssChecker=function(){return i},this.addFeed=function(t){return e.jsonp("https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=10&q="+encodeURIComponent(t.link)+"&method=JSON&callback=JSON_CALLBACK&output=xml").then(function(a){if(void 0===t.link)throw new Error("Enter Rss feed link");if(void 0===t.category)throw new Error("Choose category");if(null===a.data.responseData)throw new Error("URL is incorrect or does not contain RSS Feed data");var o=new DOMParser;xmlDoc=o.parseFromString(a.data.responseData.xmlString,"text/xml");var n=i(xmlDoc);if(n===-1)throw new Error("URL is incorrect or does not contain RSS Feed data");var l=s(xmlDoc,t,n);return e.post("/users/"+r.userID()+"/addFeed",l,{headers:{Authorization:"Bearer "+r.getToken()}})})},this.removeFeed=function(t){return e["delete"]("/users/"+r.userID()+"/deleteFeed/"+t,{headers:{Authorization:"Bearer "+r.getToken()}})},this.setFeedsOrder=function(){for(var t={newCategories:[]},a=0;a<that.feedsDictionary.length;a++)t.newCategories.push(that.feedsDictionary[a].key);return e.post("/users/"+r.userID()+"/setCategoryOrder",t,{headers:{Authorization:"Bearer "+r.getToken()}})},this.setFavsOrder=function(){for(var t={newCategories:[]},a=0;a<that.favouritesDictionary.length;a++)t.newCategories.push(that.favouritesDictionary[a].key);return e.post("/users/"+r.userID()+"/setFavsCategoryOrder",t,{headers:{Authorization:"Bearer "+r.getToken()}})}}]),function(){"use strict";angular.module("rssreader").factory("profileService",["$window","Upload","accountInfo","$auth",function(e,t,r,a){var o={profile:{},getProfile:function(){if(a.isAuthenticated())return r.getProfile().then(function(e){for(var t=e.data.user.length,r=0;r<t;r++)e.data.user[r].email===a.getPayload().email&&(o.profile=e.data.user[r])})},refreshProfileData:function(){return o.profile}};return o}])}(),angular.module("rssreader").service("themeService",["authService","$window",function(e,t){that=this,this.layout="style",this.getTheme=function(){return void 0!==that.layout?that.layout:"style"},this.layouts=[{name:"Blue",url:"style"},{name:"Black",url:"style2"},{name:"Grey",url:"style3"}]}]),function(){"use strict";angular.module("rssreader").service("toasterService",["$rootScope","$compile","$animate",function(e,t,r){var a=angular.element("body"),o=function(o,n,i){var s=arguments[2],l=angular.element(document.createElement("toaster"));l.addClass("toaster-wrapper"),l.addClass(o.type),o.overlay&&l.attr("overlay",o.overlay),o.delay&&l.attr("delay",o.delay),o.confirm&&l.attr("confirm",o.confirm);var c=angular.element(document.createElement("div"));c.addClass("toaster-icon"),c.addClass(o.iconClass),l.append(c),l.append("<span>"+o.message+"</span>"),o.htmlContent&&l.append("<span>"+o.htmlContent+"</span>");var u;u="object"==typeof arguments[1]?t(l,n)(n.$new()):t(l,n)(e.$new()),r.enter(u,a).then(function(){"function"==typeof s&&i()})};this.success=function(e,t,r,a){var n,i={message:e,type:"toaster-success",iconClass:"fa fa-check",delay:3e3};n="object"==typeof t?angular.extend({},i,t):i,
o(n,r,a)},this.info=function(e,t,r,a){var n,i={message:e,type:"toaster-info",iconClass:"fa fa-info",delay:3e3};n="object"==typeof arguments[1]?angular.extend({},i,t):i,o(n,r,a)},this.error=function(e,t,r,a){var n,i={message:e,type:"toaster-error",iconClass:"fa fa-exclamation-triangle",delay:3e3};n="object"==typeof arguments[1]?angular.extend({},i,t):i,o(n,r,a)},this.custom=function(e,t,r){var a,n={message:message,type:"toaster-default",overlay:!0,iconClass:"fa fa-info"};a="object"==typeof arguments[0]?angular.extend({},n,e):n,o(a,t,r)},this.confirm=function(e,t,r){var a,n={message:"Confirm?",type:"toaster-default",overlay:!0,iconClass:"fa fa-question",htmlContent:"<button class='app-btn-toaster-red' aria-label='Justify' ng-click='confirm()'>yes</button><button class='app-btn-toaster' aria-label='Justify' ng-click='reject()'>no</button>"};a="object"==typeof e?angular.extend({},n,e):n,o(a,t,r)},this.removeToaster=function(e){r.leave(e,a).then(function(){})}}])}(),angular.module("rssreader").factory("transfer",[function(){function e(e){d=e}function t(){return d}function r(e){u=e}function a(){return u}function o(e){c=e}function n(){return c}function i(e){l=e}function s(){return l}var l={},c="",u="",d="";return{setObj:i,getObj:s,setString:o,getString:n,setProviderString:r,getProviderString:a,setEmail:e,getEmail:t}}]);