!function(){"use strict";angular.module("rssreader",["ui.router","ngAnimate","ngValidate","ngMaterial","ngFileUpload","favicon","dndLists","satellizer","angular-jwt","toastr"]).config(["$stateProvider","$urlRouterProvider","$authProvider",function(e,t,r){t.otherwise("home"),e.state("home",{url:"/home",templateUrl:"./partials/home.html",controller:"HomeController"}).state("login",{url:"/login",templateUrl:"./partials/auth/login.html",controller:"AuthController",onEnter:["$state","authService",function(e,t){t.isLoggedIn()&&e.go("home")}]}).state("register",{url:"/register",templateUrl:"./partials/auth/register.html",controller:"AuthController",onEnter:["$state","authService",function(e,t){t.isLoggedIn()&&e.go("home")}]}).state("profile",{url:"/profile",templateUrl:"./partials/auth/profile.html",controller:"ProfileController",onEnter:["$state","authService",function(e,t){t.isLoggedIn()||(t.logOut(),e.go("home"))}]}).state("dashboard",{url:"/dashboard",views:{"":{templateUrl:"./partials/dashboard/dashboard.html",controller:"DashboardController"},"sidebar@dashboard":{templateUrl:"./partials/dashboard/sidebar.html",controller:"SidebarController"},"feedHead@dashboard":{templateUrl:"./partials/dashboard/feed-head.html",controller:"DashboardController"}},resolve:{feedPromise:["feedsService",function(e){return e.getAllFeeds()}]},onEnter:["articlesService","dashboardService","feedsService","$state","authService",function(e,t,r,o,n){e.getAllArticles()}]}).state("dashboard.list",{url:"/list",templateUrl:"./partials/list/list.html",controller:"ArticlesController"}).state("dashboard.th-list",{url:"/th-list",templateUrl:"./partials/list/th-list.html",controller:"ArticlesController"}).state("dashboard.th-large",{url:"/th-large",templateUrl:"./partials/list/th-large.html",controller:"ArticlesController"}).state("dashboard.addFeed",{url:"/add",templateUrl:"./partials/dashboard/add-feed.html",controller:"FeedsController",onEnter:["dashboardService",function(e){e.setTitle("Add Feed")}]}),r.facebook({clientId:"173686319709284",name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:window.location.origin+"/",requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",oauthType:"2.0",popupOptions:{width:580,height:400}}),r.google({clientId:"806677097865-va2i3kq96mmu8i00t9k6q92ks1s9tg0l.apps.googleusercontent.com",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:"http://localhost:8080",requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:452,height:633}})}])}(),function(){"use strict";angular.module("rssreader").controller("ArticlesController",["$scope","$state","articlesService","dashboardService",function(e,t,r,o){e.articles=r.articles,e.isFavourites=r.checkIfFavourites,e.addFavourite=function(e){r.addFavourite(e).then(function(e){t.reload("dashboard"),o.successMsg="Article successfully added to favourites"},function(e){console.log(e),o.alertMsg=e.data.message})},e.removeFavourite=function(e){r.removeFavourite(e).then(function(e){t.reload("dashboard")},function(e){console.log(e)})}}])}(),function(){"use strict";angular.module("rssreader").controller("AuthController",["$scope","$state","authService","$window","dashboardService","$auth","transfer","jwtHelper","toastr",function(e,t,r,o,n,a,i,s,l){e.user={},e.session;var u={field_required:"This field is required",email_example:"Please, use example: jacksparrow@gmail.com",char_num6_required:"Please, enter at least 6 characters",char_num9_required:"Please, enter at least 9 characters",char_num20_required:"Please, enter at least 20 characters"};e.register=function(o){o.validate()&&r.register(e.user).error(function(t){e.error=t}).then(function(e){t.go("dashboard."+n.getViewMode(),{id:r.userID()})})},e.logIn=function(a){a.validate()&&r.logIn(e.user,e.session).error(function(t){e.error=t}).then(function(){e.session?(t.go("dashboard."+n.getViewMode(),{id:r.userID()}),l.success("You have successfully login")):(e.onExit=function(){auth.logOut()},t.go("dashboard."+n.getViewMode(),{id:r.userID()}),l.success("You have successfully login"),o.onbeforeunload=e.onExit)})},e.authenticate=function(e){a.authenticate(e).then(function(e){r.saveToken(e.data.token),l.success("You have successfully authenticated"),t.go("dashboard."+n.getViewMode(),{id:r.userID()})})},e.validationLoginOptions={rules:{mail:{required:!0,email:!0},pwd:{required:!0}},messages:{mail:{required:u.field_required,email:u.email_example},pwd:{required:u.field_required}}},e.validationRegistrOptions={rules:{mail:{required:!0,email:!0,minlength:9,maxlength:20},pwd:{required:!0,minlength:6,maxlength:20},reppwd:{required:!0,minlength:6,maxlength:20}},messages:{mail:{required:u.field_required,email:u.email_example,minlength:u.char_num9_required,maxlength:u.char_num20_required},pwd:{required:u.field_required,minlength:u.char_num6_required,maxlength:u.char_num20_required},reppwd:{required:u.field_required,minlength:u.char_num6_required,maxlength:u.char_num20_required}}}}])}(),function(){"use strict";angular.module("rssreader").controller("DashboardController",["$scope","$state","$timeout","dashboardService","feedsService",function(e,t,r,o,n){e.modalShown=!1,n.feedsDictionary.length?(o.setTitle("All"),t.go("dashboard."+o.getViewMode())):(o.setTitle("Add Feed"),t.go("dashboard.addFeed")),e.headTitle=o.getTitle,e.feed=o.getFeedId,e.alertMsg=o.alertMsg,e.successMsg=o.successMsg,e.hideViewBtns=function(){return"Add Feed"===e.headTitle()||0==n.feedsDictionary.length},e.checkIfToggled=function(e){return o.getViewMode()===e},e.onViewChange=function(e){switch(e){case"view-mode1":o.setViewMode(0);break;case"view-mode2":o.setViewMode(1);break;case"view-mode3":o.setViewMode(2)}t.go("dashboard."+o.getViewMode())},e.onFeedDelete=function(){e.modalShown=!e.modalShown},e.confirmFeedDelete=function(){n.removeFeed(o.getFeedId()).then(function(e){t.reload("dashboard")},function(e){console.log(e)})},e.$watch("alertMsg",function(t){t&&t.length&&r(function(){e.alertMsg=null},4e3)}),e.$watch("successMsg",function(t){t&&t.length&&r(function(){e.successMsg=null},4e3)})}])}(),function(){"use strict";angular.module("rssreader").controller("FeedsController",["$scope","$state","$http","feedsService","dashboardService","articlesService","authService",function(e,t,r,o,n,a,i){e.obj={},e.feeds=o.feedsDictionary,e.categories=o.CATEGORIES,e.addFeed=function(){e.error="",o.addFeed(e.obj).then(function(e){t.reload("dashboard")},function(t){console.log(t),t.data?e.error=t.data.message:e.error=t.message})}}])}(),function(){"use strict";angular.module("rssreader").controller("HomeController",["$scope","$state","authService","dashboardService","feedsService",function(e,t,r,o,n){e.isLoggedIn=r.isLoggedIn,e.currentUser=r.currentUser,e.models={selected:null,lists:{A:[]}};for(var a=1;a<=3;++a)e.models.lists.A.push({label:"Item A"+a});e.onFeeds=function(){r.isLoggedIn()?t.go("dashboard."+o.getViewMode(),{id:r.userID()}):alert("Unauthtorized")},e.onRegister=function(){t.go("register")},e.onLogin=function(){t.go("login")}}])}(),function(){angular.module("rssreader").controller("IndexController",["$scope","authService","$window","themeService",function(e,t,r,o){e.layout=o.getTheme,e.text="some text"}])}(),function(){"use strict";angular.module("rssreader").controller("NavbarController",["$scope","$state","authService","transfer","accountInfo","$auth",function(e,t,r,o,n,a){e.isLoggedIn=r.isLoggedIn,e.currentUser=r.currentUser,e.logOut=function(){r.logOut(),t.go("home")},e.goHome=function(){e.isLoggedIn()?t.go("dashboard"):t.go("home")},e.getProfile=function(){n.getProfile().then(function(t){if(a.isAuthenticated()){for(var r=t.data.user.length,o=0;o<r;o++)t.data.user[o].email===a.getPayload().email&&(e.profile=t.data.user[o]);console.log(e.profile)}})},e.getProfile()}])}(),function(){"use strict";angular.module("rssreader").controller("ProfileController",["Upload","$http","$state","profileService","$scope","authService","$window","themeService","dashboardService","$auth","accountInfo","toastr",function(e,t,r,o,n,a,i,s,l,u,d,c){n.getProfile=function(){d.getProfile().then(function(e){if(u.isAuthenticated()){for(var t=e.data.user.length,r=0;r<t;r++)e.data.user[r].email===u.getPayload().email&&(n.profile=e.data.user[r]);console.log(n.profile)}})},n.getProfile(),n.link=function(e){u.link(e).then(function(){c.info("You have successfully linked a "+e+" account"),n.getProfile()})},n.unlink=function(e){t.post("/auth/unlink",{id:n.profile._id,provider:e}).then(function(t){c.info("You have unlinked a "+e+" account"),n.getProfile(),console.log(t)})},n.updateProfile=function(){n.getProfile()},n.getProfile(),n.submit=function(){console.log(n.file),n.upload_form.file.$valid&&n.file&&n.upload(n.file)},n.url="http://localhost:8080/upload",n.upload=function(t){e.upload({url:n.url,headers:{Authorization:"Bearer "+a.getToken()},data:{file:t}}).then(function(e){0===e.data.error_code?i.alert("Success "+e.config.data.file.name+"uploaded. Response: "):i.alert("an error occured")},function(e){console.log("Error status: "+e.status),i.alert("Error status: "+e.status)},function(e){console.log(e);var t=parseInt(100*e.loaded/e.total);console.log("progress: "+t+"% "+e.config.data.file.name),n.progress="progress: "+t+"% "})},n.newUserData={email:a.currentUser(),currentPass:"",newPass:"",newPassRepeat:""},n.changePass=function(){return console.log("Submit change password"),t.post("/changePassword",n.newUserData,{headers:{Authorization:"Bearer "+a.getToken()}}).success(function(e){a.saveToken(e.token),r.go("dashboard."+l.getViewMode(),{id:a.userID()})}).error(function(e){n.err=e,console.log(e.message)})},n.user=a.currentUser,n.updateTheme=function(){s.layout=n.layout,console.log("Theme update"),console.log("Theme:"+s.layout)},n.layout=s.layout,n.layouts=s.layouts}])}(),function(){"use strict";angular.module("rssreader").controller("SidebarController",["$scope","$state","feedsService","articlesService","dashboardService",function(e,t,r,o,n){e.feeds=r.feedsDictionary,e.favs=r.favourites,e.onDrag=function(t){e.feeds.splice(t,1),r.setCategoryOrder()},e.getAll=function(){1===e.feeds.length&&1===e.feeds[0].values.length?e.getByFeed(e.feeds[0].values[0]):o.getAllArticles(),t.go("dashboard."+n.getViewMode())},e.getByFeed=function(e){o.getArticlesByFeed(e),t.go("dashboard."+n.getViewMode())},e.getByCat=function(r,a){1==e.feeds[a].values.length?e.getByFeed(e.feeds[a].values[0]):o.getArticlesByCat(r),t.go("dashboard."+n.getViewMode())},e.getFavourites=function(){o.getFavourites(),t.go("dashboard."+n.getViewMode())},e.getFavArticle=function(e){o.getFavArticle(e),t.go("dashboard."+n.getViewMode())},e.hideFavourites=function(){return e.favs.length},e.checkIfEmpty=function(){return 0!=r.feedsDictionary.length},e.toggle=!1}])}(),angular.module("rssreader").directive("toaster",[function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(e,t,r){e.dialogStyle={},r.width&&(e.dialogStyle.width=r.width),r.height&&(e.dialogStyle.height=r.height),e.hideModal=function(){e.show=!1}},templateUrl:"../partials/others/toaster.html"}}]),angular.module("rssreader").factory("accountInfo",["$http",function(e){return{getProfile:function(){return e.get("/api/me")},updateProfile:function(t){return e.put("/api/me",t)}}}]),function(){"use strict";angular.module("rssreader").factory("articlesService",["$http","$q","authService","$timeout","dashboardService","feedsService",function(e,t,r,o,n,a){var i=50,s={articles:[],isFavourites:!1,checkIfFavourites:function(){return s.isFavourites},getAllArticles:function(){s.isFavourites=!1,s.articles.length=0,n.setTitle("All"),n.resetFeedId(),angular.forEach(a.feedsDictionary,function(e,t){angular.forEach(e.values,function(e,t){return d(e)})})},getArticlesByFeed:function(e){s.articles.length=0,s.isFavourites=!1,n.setTitle(e.title),n.setFeedId(e._id),d(e)},getArticlesByCat:function(e){s.isFavourites=!1,s.articles.length=0,n.setTitle(e),n.resetFeedId(),angular.forEach(a.feedsDictionary,function(t,r){t.key===e&&angular.forEach(t.values,function(e,t){d(e)})})},getFavourites:function(){s.isFavourites=!0,s.articles.length=0,n.setTitle("Favourites"),n.resetFeedId(),angular.copy(a.favourites,s.articles)},getFavArticle:function(e){s.isFavourites=!0,n.setTitle("Favourites"),n.resetFeedId(),s.articles.length=0,s.articles.push(e)},addFavourite:function(t){return e.post("/users/"+r.userID()+"/addFavArticle",t,{headers:{Authorization:"Bearer "+r.getToken()}})},removeFavourite:function(t){return e["delete"]("/users/"+r.userID()+"/deleteFavFeed/"+t._id,{headers:{Authorization:"Bearer "+r.getToken()}})}},l=function(e,t){var r="";if("RSS"===t)if(e.getElementsByTagName("enclosure").length)r=e.getElementsByTagName("enclosure")[0].getAttribute("url");else{try{r=$(e).find("media\\:content, content")[0].getAttribute("url")}catch(o){r=""}if(""==r||void 0==r)try{var n=document.createElement("div");n.innerHTML=e.getElementsByTagName("description")[0].textContent,r=$(n).find("img")[0].src}catch(o){r=""}}else if("ATOM"===t&&!e.getElementsByTagName("enclosure").length)try{var n=document.createElement("div");n.innerHTML=e.getElementsByTagName("content")[0].textContent,r=$(n).find("img")[0].src}catch(o){r=""}return r},u=function(e,t){var r="";if("RSS"===t)try{r=document.createElement("div"),r.innerHTML=e.getElementsByTagName("description")[0].textContent,r=$(r).text()}catch(o){}else"ATOM"===t&&(r=$(e.getElementsByTagName("content")[0].childNodes[0].data).text());return r},d=function(t){return e.jsonp("https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num="+i+"&q="+encodeURIComponent(t.rsslink)+"&method=JSONP&callback=JSON_CALLBACK&output=xml").then(function(e){var r=new DOMParser,o=r.parseFromString(e.data.responseData.xmlString,"text/xml"),n=[];if("RSS"===t.format){n=o.getElementsByTagName("item");for(var a=0;a<n.length;a++){var i={title:n[a].getElementsByTagName("title")[0].innerHTML,link:n[a].getElementsByTagName("link")[0].textContent,img:l(n[a],t.format),content:u(n[a],t.format),date:n[a].getElementsByTagName("pubDate")[0].textContent};i.content=i.content||i.title,s.articles.push(i)}}else if("ATOM"===t.format){n=o.getElementsByTagName("entry");for(var a=0;a<n.length;a++){var i={title:n[a].getElementsByTagName("title")[0].textContent,link:n[a].getElementsByTagName("id")[0].textContent,img:l(n[a],t.format),content:u(n[a],t.format),date:n[a].getElementsByTagName("published")[0].textContent};i.content=i.content||i.title,s.articles.push(i)}}})};return s}])}(),function(){"use strict";angular.module("rssreader").factory("authService",["$http","$window","$auth","transfer","jwtHelper",function(e,t,r,o,n){var a={saveToken:function(e){r.setToken(e)},getToken:function(){return r.getToken()},isLoggedIn:function(){return r.isAuthenticated()},currentUser:function(){if(a.isLoggedIn())return r.getPayload().email},userID:function(){if(a.isLoggedIn()){var e=r.getPayload();return console.log(e),e.sub}},register:function(t){return e.post("/register",t).success(function(e){a.saveToken(e.token)}).error(function(e){console.log(e.message)})},logIn:function(t){return e.post("/login",t).success(function(e){a.saveToken(e.token)}).error(function(e){console.log(e.message)})},logOut:function(){r.removeToken(),r.logout()}};return a}])}(),angular.module("rssreader").service("dashboardService",[function(){var e=this;this.DEFAULT_VIEW=2,this.currentViewMode=e.DEFAULT_VIEW,this.viewModes=["list","th-list","th-large"],this.resetViewMode=function(){e.currentViewMode=e.DEFAULT_VIEW},this.setViewMode=function(t){if(t>e.viewModes.length-1)throw new Error("View mode you are trying to set is not defined");e.currentViewMode=t},this.getViewMode=function(){return e.viewModes[e.currentViewMode]},this.title="",this.setTitle=function(t){"Add Feed"==t&&this.resetFeedId(),e.title=t},this.getTitle=function(){return e.title},this.currentView=this.DEFAULT_VIEW,this.currentFeed="",this.getFeedId=function(){return e.currentFeed},this.setFeedId=function(t){e.currentFeed=t},this.resetFeedId=function(){e.currentFeed=""}}]),angular.module("rssreader").service("feedsService",["$http","$state","authService","dashboardService",function(e,t,r,o){that=this,this.feedsDictionary=[],this.favourites=[],this.allArticles=[],this.CATEGORIES=["News","IT","Sport","Design","Movies","Music","Culture","Nature","Economics","Science"],this.getAllFeeds=function(){return e.get("/users/"+r.userID(),{headers:{Authorization:"Bearer "+r.getToken()}}).then(function(e){angular.copy(e.data,that.feedsDictionary),that.getAllFavourites().then(function(e){angular.copy(e.data,that.favourites)})})},this.getAllFavourites=function(){return e.get("/users/"+r.userID()+"/favourites",{headers:{Authorization:"Bearer "+r.getToken()}})};var n=function(e){return e.getElementsByTagName("rss").length?"RSS":e.getElementsByTagName("feed").length?"ATOM":-1},a=function(e,t,r){var o={};if("RSS"===r){var n=e.getElementsByTagName("channel")[0];o.title=n.getElementsByTagName("title")[0].childNodes[0].nodeValue,o.description=n.getElementsByTagName("description")[0].childNodes[0].nodeValue,o.link=n.getElementsByTagName("link")[0].childNodes[0].nodeValue,o.rsslink=t.link,o.category=t.category}else"ATOM"===r&&(o.title=e.getElementsByTagName("title")[0].childNodes[0].nodeValue,o.description="",o.link=e.getElementsByTagName("link")[0].getAttribute("href"),o.rsslink=t.link,o.category=t.category);return o.format=r,o};this.addFeed=function(t){return e.jsonp("https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=10&q="+encodeURIComponent(t.link)+"&method=JSON&callback=JSON_CALLBACK&output=xml").then(function(o){if(void 0===t.category)throw new Error("Choose category");if(null===o.data.responseData)throw new Error("URL is incorrect or does not contain RSS Feed data");var i=new DOMParser;xmlDoc=i.parseFromString(o.data.responseData.xmlString,"text/xml");var s=n(xmlDoc,t,s);if(s===-1)throw new Error("URL is incorrect or does not contain RSS Feed data");var l=a(xmlDoc,t,s);return e.post("/users/"+r.userID()+"/addFeed",l,{headers:{Authorization:"Bearer "+r.getToken()}})})},this.removeFeed=function(t){return e["delete"]("/users/"+r.userID()+"/deleteFeed/"+t,{headers:{Authorization:"Bearer "+r.getToken()}})},this.setCategoryOrder=function(){for(var t={newCategories:[]},o=0;o<that.feedsDictionary.length;o++)t.newCategories.push(that.feedsDictionary[o].key);return e.post("/users/"+r.userID()+"/setCategoryOrder",t,{headers:{Authorization:"Bearer "+r.getToken()}})}}]),function(){"use strict";angular.module("rssreader").service("profileService",["$window","Upload",function(e,t){}])}(),angular.module("rssreader").service("themeService",["authService","$window",function(e,t){that=this,this.layout="style",this.getTheme=function(){return void 0!==that.layout?that.layout:"style"},this.layouts=[{name:"Blue",url:"style"},{name:"Black",url:"style2"},{name:"Grey",url:"style3"}]}]),angular.module("rssreader").factory("transfer",[function(){function e(e){r=e}function t(){return r}var r={};return{setObj:e,getObj:t}}]);