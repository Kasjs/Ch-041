angular.module("rssreader",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,r){r.otherwise("home"),e.state("home",{url:"/home",templateUrl:"./partials/home.html",controller:"HomeController"}).state("feeds",{url:"/users/:id",templateUrl:"./partials/feeds.html",controller:"FeedsController",resolve:{feedPromise:["$stateParams","feedsService",function(e,r){return r.get(e.id)}]}}).state("login",{url:"/login",templateUrl:"./partials/auth/login.html",controller:"AuthController"}).state("register",{url:"/register",templateUrl:"./partials/auth/register.html",controller:"AuthController"}).state("dashboard",{url:"/dashboard/:id",templateUrl:"./partials/dashboard.html",controller:"FeedsController",resolve:{feedPromise:["$stateParams","feedsService",function(e,r){return r.get(e.id)}]}})}]),angular.module("add_ctrl",[]).controller("AddCtrl",["$scope","add_feed_service",function(e,r){e.feeds=[],e.addFeed=function(){console.log("add ctrl")}}]),angular.module("rssreader").controller("AuthController",["$scope","$state","authService",function(e,r,o){e.user={},e.register=function(){o.register(e.user).error(function(r){e.error=r}).then(function(){r.go("home")})},e.logIn=function(){console.log(e.user),o.logIn(e.user).error(function(r){console.log(r),e.error=r}).then(function(){r.go("dashboard",{id:o.userID()})})}}]),angular.module("rssreader").controller("FeedsController",["$scope","$state","feedsService","authService",function(e,r,o,t){e.test="Hello world!",e.obj={},e.feeds=o.getFeeds(),e.addFeed=function(){o.addFeed(t.userID(),{title:e.obj.title,link:e.obj.link}),e.obj.title="",e.obj.link="",e.feeds=o.getFeeds()},e.removeFeed=function(e){o.removeFeed(t.userID(),e),r.reload()}}]),angular.module("rssreader").controller("HomeController",["$scope","$state","authService",function(e,r,o){e.userId=o.userID(),e.header="Welcome to Rss Reader",e.isLoggedIn=o.isLoggedIn,e.currentUser=o.currentUser,e.OnFeeds=function(){o.isLoggedIn()?r.go("dashboard",{id:e.userId}):alert("Unauthtorized")},e.OnRegister=function(){r.go("register")},e.OnLogin=function(){r.go("login")}}]),angular.module("rssreader").controller("NavController",["$scope","$state","authService",function(e,r,o){e.isLoggedIn=o.isLoggedIn,e.currentUser=o.currentUser,e.logOut=function(){o.logOut(),r.go("home")},e.goHome=function(){r.go("home")}}]),angular.module("add_service",[]).factory("add_feed_service",[function(){function e(e){o=e}function r(){return o}var o=[];return console.log(o),{setArray:e,getArray:r}}]),angular.module("rssreader").factory("authService",["$http","$window",function(e,r){var o={};return o.saveToken=function(e){r.localStorage["rss-reader-token"]=e},o.getToken=function(){return r.localStorage["rss-reader-token"]},o.isLoggedIn=function(){var e=o.getToken();if(e){var t=JSON.parse(r.atob(e.split(".")[1]));return t.exp>Date.now()/1e3}return!1},o.currentUser=function(){if(o.isLoggedIn()){var e=o.getToken(),t=JSON.parse(r.atob(e.split(".")[1]));return t.email}},o.userID=function(){if(o.isLoggedIn()){var e=o.getToken(),t=JSON.parse(r.atob(e.split(".")[1]));return t._id}},o.register=function(r){return e.post("/register",r).success(function(e){o.saveToken(e.token)})},o.logIn=function(r){return console.log("sending post to /login"),e.post("/login",r).success(function(e){console.log("Saving data"),o.saveToken(e.token)})},o.logOut=function(){r.localStorage.removeItem("rss-reader-token")},o}]),angular.module("rssreader").service("feedsService",["$http","authService",function(e,r){var o=[];return{get:function(t){return e.get("/users/"+t,{headers:{Authorization:"Bearer "+r.getToken()}}).then(function(e){angular.copy(e.data.feeds,o)})},getFeeds:function(){return o},addFeed:function(t,n){return e.post("/users/"+t+"/addFeed",n,{headers:{Authorization:"Bearer "+r.getToken()}}).success(function(e){o.push(e)})},removeFeed:function(o,t){return console.log(t),e["delete"]("/users/"+o+"/deleteFeed/"+t,{headers:{Authorization:"Bearer "+r.getToken()}}).success(function(e){console.log("deleted")})}}}]);