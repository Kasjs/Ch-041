angular.module("rssreader",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,r){r.otherwise("home"),e.state("home",{url:"/home",templateUrl:"./partials/home.html",controller:"HomeController"}).state("feeds",{url:"/users/:id",templateUrl:"./partials/feeds.html",controller:"FeedsController",resolve:{feedPromise:["$stateParams","feedsService",function(e,r){return r.get(e.id)}]}}).state("login",{url:"/login",templateUrl:"./partials/auth/login.html",controller:"AuthController"}).state("register",{url:"/register",templateUrl:"./partials/auth/register.html",controller:"AuthController"}).state("dashboard",{url:"/dashboard/:id",templateUrl:"./partials/dashboard.html",controller:"FeedsController",resolve:{feedPromise:["$stateParams","feedsService",function(e,r){return r.get(e.id)}]}})}]),function(){$("#menu-toggle").click(function(e){console.log("Called"),e.preventDefault(),$("#wrapper").toggleClass("toggled")}),$("#toggleBtn").click(function(){$("#glyphToggle").toggleClass(" glyphicon-align-justify glyphicon-remove")}),$("#feeds").click(function(){$("#glyphFeeds").toggleClass("glyphicon-chevron-right glyphicon-chevron-down")})}(),$(document).ready(function(){$("#loginform").validate({rules:{mail:{required:!0,email:!0},pwd:{required:!0}},messages:{mail:{required:"This field is required ",email:""},pwd:{required:"This field is required "}}}),$("#registration").validate({rules:{mail:{required:!0,email:!0,minlength:9,maxlength:20},pwd:{required:!0,minlength:6,maxlength:20},reppwd:{required:!0,minlength:6,maxlength:20}},messages:{mail:{required:"This field is required ",email:"Please, use example: jacksparrow@gmail.com ",minlength:"Please, enter at least 9 characters ",maxlength:"Please, enter no more than 20 characters. "},pwd:{required:"This field is required ",minlength:"Please, enter at least 6 characters ",maxlength:"Please, enter no more than 20 characters. "},reppwd:{required:"This field is required ",minlength:"Please, enter at least 6 characters ",maxlength:"Please, enter no more than 20 characters. "}}})}),angular.module("add_ctrl",[]).controller("AddCtrl",["$scope","add_feed_service",function(e,r){e.feeds=[],e.addFeed=function(){console.log("add ctrl")}}]),angular.module("rssreader").controller("AuthController",["$scope","$state","authService",function(e,r,t){e.user={},e.register=function(){t.register(e.user).error(function(r){e.error=r}).then(function(){r.go("home")})},e.logIn=function(){console.log(e.user),t.logIn(e.user).error(function(r){console.log(r),e.error=r}).then(function(){r.go("home")})}}]),angular.module("rssreader").controller("FeedsController",["$scope","$state","feedsService","authService",function(e,r,t,o){e.test="Hello world!",e.obj={},e.feeds=t.getFeeds(),e.addFeed=function(){t.addFeed(o.userID(),{title:e.obj.title,link:e.obj.link}),e.obj.title="",e.obj.link="",e.feeds=t.getFeeds()},e.removeFeed=function(e){t.removeFeed(o.userID(),e),r.reload()}}]),angular.module("rssreader").controller("HomeController",["$scope","$state","authService",function(e,r,t){e.userId=t.userID(),e.header="Welcome to Rss Reader",e.OnFeeds=function(){t.isLoggedIn()?r.go("dashboard",{id:e.userId}):alert("Unauthtorized")},e.OnRegister=function(){r.go("register")},e.OnLogin=function(){r.go("login")}}]),angular.module("rssreader").controller("NavController",["$scope","$state","authService",function(e,r,t){e.isLoggedIn=t.isLoggedIn,e.currentUser=t.currentUser,e.logOut=function(){t.logOut(),r.go("home")},e.goHome=function(){r.go("home")}}]),angular.module("add_service",[]).factory("add_feed_service",[function(){function e(e){t=e}function r(){return t}var t=[];return console.log(t),{setArray:e,getArray:r}}]),angular.module("rssreader").factory("authService",["$http","$window",function(e,r){var t={};return t.saveToken=function(e){r.localStorage["rss-reader-token"]=e},t.getToken=function(){return r.localStorage["rss-reader-token"]},t.isLoggedIn=function(){var e=t.getToken();if(e){var o=JSON.parse(r.atob(e.split(".")[1]));return o.exp>Date.now()/1e3}return!1},t.currentUser=function(){if(t.isLoggedIn()){var e=t.getToken(),o=JSON.parse(r.atob(e.split(".")[1]));return o.email}},t.userID=function(){if(t.isLoggedIn()){var e=t.getToken(),o=JSON.parse(r.atob(e.split(".")[1]));return o._id}},t.register=function(r){return e.post("/register",r).success(function(e){t.saveToken(e.token)})},t.logIn=function(r){return console.log("sending post to /login"),e.post("/login",r).success(function(e){console.log("Saving data"),t.saveToken(e.token)})},t.logOut=function(){r.localStorage.removeItem("rss-reader-token")},t}]),angular.module("rssreader").service("feedsService",["$http","authService",function(e,r){var t=[];return{get:function(o){return e.get("/users/"+o,{headers:{Authorization:"Bearer "+r.getToken()}}).then(function(e){angular.copy(e.data.feeds,t)})},getFeeds:function(){return t},addFeed:function(o,n){return e.post("/users/"+o+"/addFeed",n,{headers:{Authorization:"Bearer "+r.getToken()}}).success(function(e){t.push(e)})},removeFeed:function(t,o){return console.log(o),e["delete"]("/users/"+t+"/deleteFeed/"+o,{headers:{Authorization:"Bearer "+r.getToken()}}).success(function(e){console.log("deleted")})}}}]);